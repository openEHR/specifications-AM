<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.21">
<meta name="description" content="openEHR Archetype Identification">
<meta name="keywords" content="archetype, identification, governance, openehr">
<title>Archetype Identification</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_archetype_identification">Archetype Identification</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
<li><a href="#_supporters">Supporters</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
<li><a href="#_conformance">1.5. Conformance</a></li>
<li><a href="#_tools">1.6. Tools</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_scope">2.1. Scope</a></li>
<li><a href="#_environment">2.2. Environment</a></li>
<li><a href="#_the_problem">2.3. The Problem</a></li>
<li><a href="#_human_readable_and_machine_identifiers">2.4. Human-readable and Machine Identifiers</a></li>
<li><a href="#_meta_data">2.5. Meta-data</a></li>
</ul>
</li>
<li><a href="#_source_artefact_identification">3. Source Artefact Identification</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">3.1. Overview</a></li>
<li><a href="#_formal_model">3.2. Formal Model</a>
<ul class="sectlevel3">
<li><a href="#_human_readable_identifier_hrid">3.2.1. Human-readable Identifier (HRID)</a>
<ul class="sectlevel4">
<li><a href="#_concept_identifier">3.2.1.1. Concept Identifier</a></li>
<li><a href="#_legacy_adl_1_4_semantics">3.2.1.2. Legacy ADL 1.4 Semantics</a></li>
<li><a href="#_concept_identifier_semantics">3.2.1.3. Concept Identifier Semantics</a></li>
<li><a href="#_need_for_rm_class_name_in_identifier">3.2.1.4. Need for RM Class Name in Identifier</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_versioning">4. Versioning</a>
<ul class="sectlevel2">
<li><a href="#_general_model">4.1. General Model</a></li>
<li><a href="#_version_numbering">4.2. Version Numbering</a></li>
<li><a href="#_change_semantics">4.3. Change Semantics</a></li>
<li><a href="#_versionable_interface_for_archetypes">4.4. Versionable 'interface' for archetypes</a>
<ul class="sectlevel3">
<li><a href="#_interface_preservation">4.4.1. Interface preservation</a></li>
<li><a href="#_major_version_breaking_changes">4.4.2. Major version (breaking) changes</a></li>
<li><a href="#_minor_version_changes">4.4.3. Minor version changes</a></li>
<li><a href="#_patch_version_changes">4.4.4. Patch version changes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_lifecycle_model">5. Lifecycle Model</a>
<ul class="sectlevel2">
<li><a href="#_conceptual_model">5.1. Conceptual Model</a></li>
<li><a href="#_lifecycle_based_versioning">5.2. Lifecycle-based Versioning</a></li>
</ul>
</li>
<li><a href="#_distributed_governance">6. Distributed Governance</a>
<ul class="sectlevel2">
<li><a href="#_overview_3">6.1. Overview</a></li>
<li><a href="#_management">6.2. Management</a></li>
<li><a href="#_transfer_and_forking">6.3. Transfer and Forking</a></li>
</ul>
</li>
<li><a href="#_referencing">7. Referencing</a>
<ul class="sectlevel2">
<li><a href="#_source_artefact_references">7.1. Source Artefact References</a>
<ul class="sectlevel3">
<li><a href="#_archetype_external_references_adlaom_2">7.1.1. Archetype External References (ADL/AOM 2)</a></li>
<li><a href="#_template_references_to_archetypes_and_templates">7.1.2. Template References to Archetypes and Templates</a></li>
<li><a href="#_between_specialised_archetypes">7.1.3. Between Specialised Archetypes</a></li>
</ul>
</li>
<li><a href="#_source_artefact_relationship_constraints">7.2. Source Artefact Relationship Constraints</a>
<ul class="sectlevel3">
<li><a href="#_adl_1_4_archetype_slots">7.2.1. ADL 1.4 Archetype Slots</a></li>
<li><a href="#_adl_2_archetype_slots">7.2.2. ADL 2 Archetype Slots</a></li>
</ul>
</li>
<li><a href="#_aql_query_sets">7.3. AQL Query Sets</a></li>
<li><a href="#_aql_queries">7.4. AQL Queries</a></li>
<li><a href="#_operational_artefacts">7.5. Operational Artefacts</a></li>
<li><a href="#_references_from_data">7.6. References from Data</a>
<ul class="sectlevel3">
<li><a href="#_requirements">7.6.1. Requirements</a></li>
<li><a href="#_reconstitutability">7.6.2. Reconstitutability</a></li>
<li><a href="#_supporting_archetype_based_querying">7.6.3. Supporting Archetype-based Querying</a></li>
<li><a href="#_formal_model_2">7.6.4. Formal Model</a></li>
<li><a href="#_optimisations">7.6.5. Optimisations</a>
<ul class="sectlevel4">
<li><a href="#_identifier_aliasing">7.6.5.1. Identifier Aliasing</a></li>
<li><a href="#_reference_compression">7.6.5.2. Reference Compression</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_a_reliable_uri_for_knowledge_resources">8. A Reliable URI for Knowledge Resources</a></li>
<li><a href="#_artefact_authentication">9. Artefact Authentication</a>
<ul class="sectlevel2">
<li><a href="#_integrity_check">9.1. Integrity Check</a></li>
<li><a href="#_authentication">9.2. Authentication</a></li>
<li><a href="#_canonical_form_archetype_semantic_view">9.3. Canonical Form – Archetype 'semantic view'</a></li>
</ul>
</li>
<li><a href="#_scenarios">10. Scenarios</a>
<ul class="sectlevel2">
<li><a href="#_minor_version_upgrade">10.1. Minor Version Upgrade</a></li>
<li><a href="#_major_version_upgrade">10.2. Major Version Upgrade</a></li>
<li><a href="#_templates_using_archteypes_and_subsets">10.3. Templates using Archteypes and Subsets</a></li>
<li><a href="#_artefact_transfer_fork">10.4. Artefact Transfer / Fork</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_archetype_identification" class="sect0"><a class="anchor" href="#_archetype_identification"></a>Archetype Identification</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: AM latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: STABLE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: archetype, identification, governance, openehr</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2009 - 2024 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/AM/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser, Implementer</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>AM Release 2.1.?</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>0.7.9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECPUB-7" target="_blank" rel="noopener">SPECPUB-7</a>: Convert citations to bibtex form.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>15 Dec 2019</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECAM-58" target="_blank" rel="noopener">SPECAM-58</a>. Correct errors and improve examples - S Garde review Nov 2018. Change <code><em>instance_uid</em></code> to <code><em>build_uid</em></code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18 Nov 2018</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>AM Release 2.1.0</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECAM-52" target="_blank" rel="noopener">SPECAM-52</a>Improve explanation of version number progression in section 4.2; correct version identifier grammar (addresses <a href="https://specifications.openehr.org/tickets/SPECPR-254" target="_blank" rel="noopener">SPECPR-254</a>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E Sundvall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13 Feb 2018</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Correct formatting, re-instate Archetype model diagram at start of section 3.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">28 Jan 2018</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECAM-41" target="_blank" rel="noopener">SPECAM-41</a>. Correct 'unstable' to 'alpha'; correct version-related typo; update versioning incrementing rules.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18 Jun 2017</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>AM Release 2.0.6</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace <code>'-unstable'</code> with <code>'-alpha'</code> to be compatible with typical tools.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I McNicoll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01 Feb 2015</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replace <code>'+uNNN'</code> with <code>'-unstable'</code>; simplify the number after <code>'rc'</code> to an integer build count.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde,<br>
 I McNicoll,<br>
 H Leslie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29 Sep 2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove <code><em>build_count</em></code>, replace with <code><em>build_uid</em></code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I McNicoll<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">28 May 2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change <code>ARCHEYTPE_HRID.<em>commit_number</em></code> to <code><em>instance_uid</em></code>. Build_count reset to 1 on each version change. Adjust diagrams and explanations.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde<br>
 I McNicoll<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21 May 2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simplify development state in lifecycle; merge 'initial' and rename 'draft'.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde<br>
 I McNicoll</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">09 May 2014</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.7.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rewrite referencing section; update 'problem description; further grammar improvements.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 Jun 2013</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove errors and ambiguities to do with explanation of human readable identifier; improve nomenclature; rewrite grammar.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 Jun 2013</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.6.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Major update based on CKM clinical group analysis, and feedback from the CIMI and openEHR communities.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S Garde<br>
 H Leslie<br>
 I McNicoll<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21 Apr 2013</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Refinements to do with template identification.<br>
 Review from Medical Centrum Alkmaar (Netherlands).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale<br>
 M van der Meer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">01 Feb 2010</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Writing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">09 Jul 2009</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Thomas Beale, Ars Semantica, UK; openEHR International Board.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="paragraph">
<p>This specification has benefited from input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following people and institutions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sebastian Garde PhD, Ocean Informatics</p>
</li>
<li>
<p>Heather Leslie MD, Ocean Informatics</p>
</li>
<li>
<p>Ian McNicoll MD, MSc, Ocean Informatics UK</p>
</li>
<li>
<p>Martin van der Meer, Code24, Netherlands</p>
</li>
<li>
<p>David Moner PhD, Universitat Politècnica de València, Spain</p>
</li>
<li>
<p>Erik Sundvall PhD, Linkoping University, Sweden</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks"><a class="anchor" href="#_trademarks"></a>Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a registered trademark of The openEHR Foundation</p>
</li>
<li>
<p>'SNOMED CT' is a registered trademark of IHTSDO</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporters"><a class="anchor" href="#_supporters"></a>Supporters</h3>
<div class="paragraph">
<p>The work reported in this paper has been funded by the following organisations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <a href="https://www.openehr.org/community/industry_partners/" target="_blank" rel="noopener">openEHR Industry Partners</a>;</p>
</li>
<li>
<p>Better d.o.o, Slovenia</p>
</li>
<li>
<p>Ocean Informatics, UK</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>The purpose of this document is to describe an identification system for openEHR archetypes (including templates). This includes archetypes created by any organisation, including the openEHR Foundation, standards bodies and clinical modelling initiatives and government programmes.</p>
</div>
<div class="paragraph">
<p>The semantics covered include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>formal human-readable and machine identifiers;</p>
</li>
<li>
<p>versioning;</p>
</li>
<li>
<p>lifecycle management and states;</p>
</li>
<li>
<p>referencing artefacts from elsewhere;</p>
</li>
<li>
<p>deal with transfer and forking;</p>
</li>
<li>
<p>supporting integrity and non-repudiation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unless otherwise stated, in this document, the term 'artefact' refers specifically to these artefact types.</p>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a>.</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/AM/latest/Overview.html" target="_blank" rel="noopener">openEHR Archetypes Technical Overview</a>.</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/base_types.html" target="_blank" rel="noopener">openEHR Base Types Specification</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Related documents include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html" target="_blank" rel="noopener">openEHR Archetype Object Model 2 (AOM2) Specification</a>.</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/AM/latest/ADL2.html" target="_blank" rel="noopener">openEHR Archetype Description Language (ADL2) Specification</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the STABLE state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/AM/latest/Identification.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/AM/latest/Identification.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/adl" target="_blank" rel="noopener">openEHR ADL forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/AM/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/AM/history" target="_blank" rel="noopener">AM component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conformance"><a class="anchor" href="#_conformance"></a>1.5. Conformance</h3>
<div class="paragraph">
<p>Conformance of a data or software artifact to an openEHR specification is determined by a formal test of that artifact against the relevant <a href="https://specifications.openehr.org/releases/ITS/latest/index" target="_blank" rel="noopener">openEHR Implementation Technology Specification(s) (ITSs)</a>, such as an IDL interface or an XML-schema. Since ITSs are formal derivations from underlying models, ITS conformance indicates model conformance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tools"><a class="anchor" href="#_tools"></a>1.6. Tools</h3>
<div class="paragraph">
<p>Various tools exist for creating and processing archetypes. The <a href="https://www.openehr.org/downloads/ADLworkbench" target="_blank" rel="noopener">ADL Workbench</a> is a reference compiler, visualiser and editor. The openEHR tools can be <a href="https://www.openehr.org/downloads/modellingtools" target="_blank" rel="noopener">downloaded from the website</a>. Source projects can be found at the <a href="https://github.com/openEHR" target="_blank" rel="noopener">openEHR Github project</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scope"><a class="anchor" href="#_scope"></a>2.1. Scope</h3>
<div class="paragraph">
<p>This specification is designed to address the need for reliable identification and referencing of complex knowledge artefacts within a distributed authoring and consumption environment.  The focus is archetypes and templates and their derived forms, including the 'operational template'. The word 'artefact' is used to refer to any of these in general.</p>
</div>
<div class="paragraph">
<p>Related artefacts that need an identification and lifecycle management scheme include terminology subsets/ref-sets, 'query sets', and potentially things such as computable guidelines. This specification mentions these latter kinds of artefacts where relevant but does not propose anything formal for them.</p>
</div>
<div class="paragraph">
<p>Out of scope are the atomic 'concepts' and 'categories' commonly found in terminologies (e.g.: <a href="http://www.who.int/classifications/icd/en/">ICD10</a>, <a href="http://www.snomed.org">SNOMED CT</a>, <a href="http://loinc.org">LOINC</a>) and ontologies (e.g. <a href="https://code.google.com/p/ogms/">OGMS</a>, <a href="http://sig.biostr.washington.edu/projects/fm/">FMA</a>, <a href="https://bioportal.bioontology.org/ontologies/IAO">IAO</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the word 'archetype' as used in this specification means: any formal artefact written in the <a href="https://specifications.openehr.org/releases/AM/latest/ADL2.html">Archetype Definition Language (ADL)</a>, or any other serialised form of the <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html">Archetype Object Model (AOM)</a>. This includes 'template' archetypes (but not other kinds of 'templates').
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_environment"><a class="anchor" href="#_environment"></a>2.2. Environment</h3>
<div class="paragraph">
<p>Archetypes are assumed to be produced by tools, either in an unmanaged way, or in a situation in which users are connected to an Custodian Organisation (CO). Such an organisation is assumed to have a Repository (which stores and manages archetypes), and potentially a Registry (in which meta-data about archetypes is stored) and Classification (a semantic index on Artefacts, typically achieved via the use of one or more ontologies). A Custodian Organisation could be international, country level, or be owned by a company or other organisation. The figure below illustrates the key concepts and nomenclature assumed by this specification.</p>
</div>
<div id="distributed_development_environment" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/distributed_development_environment.png" alt="distributed development environment" width="70%">
</div>
<div class="title">Figure 1. Distributed Development Environment</div>
</div>
<div class="paragraph">
<p>Most COs will tend to develop archetypes based on those published by 'higher-level' (i.e. national, international) COs. To enable this, a logical ability to re-use specified releases of archetypes from 'upstream' COs by 'downstream' COs is assumed. This usually implies some kind of virtual inclusion (e.g. from one web-visible repository to another), or it may be implemented by copying and marking as read-only the received archetypes. Regardless of the particular implementation, the 'logical contents' of a repository is the totality of localy managed archetypes, plus all virtually referenced archetype libraries. This is necessary to enable most compiler-like tools to function normally.</p>
</div>
<div class="paragraph">
<p>It is assumed that archetypes can also move between COs for purposes of transfer, or due to 'forking' (i.e. splitting of a line of development, as with software). Artefacts are published in some form and consumer by User Enterprises which deploy the archetypes in some technical infrastructure.</p>
</div>
<div class="paragraph">
<p>Artefacts are ultimately consumed by User Enterprises, normally in a validated and compiled form.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_problem"><a class="anchor" href="#_the_problem"></a>2.3. The Problem</h3>
<div class="paragraph">
<p>The problem specifically addressed by this specification is that of identification and referencing of archetypes. The key characteristics of archetypes, in common with other kinds of knowledge artefacts like terminology subsets is that they are 'outside the software', and that they are independent of specific implementation technologies. The consequence is that they can be created, developed, disseminated and used independently from software artefact development.</p>
</div>
<div class="paragraph">
<p>Examples of archetypes include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an archetype for 'blood gases';</p>
</li>
<li>
<p>a template for 'discharge summary'.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Extensive experience with such artefacts in the health domain has shown that while there are many similarities to software artefact identification, there are sufficient differences to warrant an explicit scheme. The health domain is the primary domain of experience assumed here, but the principles are applicable to any domain.</p>
</div>
<div class="paragraph">
<p>The key requirements addressed here are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>identify and distinguish versions, variants and releases of 'source' archetypes within and from <em>authoring</em> environments;</p>
</li>
<li>
<p>define rules for expressing and resolving <em>references</em> between source artefacts, including version variants;</p>
</li>
<li>
<p>define rules for identification of compiled / operational artefacts derived from source artefacts;</p>
</li>
<li>
<p>define rules for evolving identifiers (including version) of artefacts over time, based on a 'standard' lifecycle for artefacts;</p>
</li>
<li>
<p>define rules for identification when artefacts are retired, moved or 'forked'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_human_readable_and_machine_identifiers"><a class="anchor" href="#_human_readable_and_machine_identifiers"></a>2.4. Human-readable and Machine Identifiers</h3>
<div class="paragraph">
<p>There are two general approaches to identification. The first is the one used in software and ontology development: <em>human-readable identifiers</em>, denoted in this specification as 'HRIDs'. Under this approach, identifiers name an artefact (e.g. a class in object-oriented software, category in an ontology) and can be used as references to connect similar artefacts in a hierarchy (e.g. according to the inheritance relationship). The second is the use of meaningless machine identifiers (more properly denoted 'machine-readable' or 'machine-resolvable' identifiers) such as GUIDs and ISO OIDs with accompanying de-referencing mechanisms. The two approaches are not mutually exclusive, nor are they equivalent.</p>
</div>
<div class="paragraph">
<p>A human-readable identification scheme can support the notion of a specialsiation / subsumption hierarchy of artefacts ('inheritance' in object programming), multi-dimensional concept spaces, flexible versioning, and formally reflects the artefact authors' and users' understanding of the concept space being modelled. Human-readable identification supports many types of computational processing. A typical software HRID is the class name <code>FastSortedList</code>. Within the software world, HRIDs are used for both source artefacts and built components such as libraries and executables, although the details of the respective types of identifier may differ.</p>
</div>
<div class="paragraph">
<p>One crucial feature of most human-readable identifiers is that they <em>may change after initial assignment</em>, for reasons of change of purpose, improved understanding of need, or external requirements change. These kinds of changes are normally limited to the early development (typically pre v1.0 phase) period in order to enable stability later on.</p>
</div>
<div class="paragraph">
<p>Machine identifiers on the other hand are not human-readable, typically do not directly support versioning (unless specifically designed to do so, usually via the use of tuples of atomic identifiers), but do enable various useful kinds of computation. They require mapping to convert to human-readable identifiers. Unlike human-readable identifiers, machine identifiers do not normally change once assigned.</p>
</div>
<div class="paragraph">
<p>One key question when using machine identifiers is: what do the identify? A logical artefact, which may exist in several minor and major versions? Each minor version? Each textually different variant that is committed to a repository? For each of these, a scheme has to be devised that correctly identifies the thing to be tracked.</p>
</div>
<div class="paragraph">
<p>It is possible to define an identification scheme in which either or both human-readable and machine identifiers are used. In schemes where machine identification alone is used, all human artefact 'identification' is relegated to meta-data description, such as names, purpose, and so on. One problem with such schemes is that meta-data characteristics are informal, and therefore can clash – preventing any formalisation of the ontological space occupied by the artefacts. Discovery of overlaps and in fact any comparative feature of artefacts cannot be easily formalised, and therefore cannot be made properly computable.</p>
</div>
<div class="paragraph">
<p>The approach assumed here is to use both types of identifier in the following way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a GUID is assigned to an artefact when it is created. It does not change, no matter what changes are made to the definition of the artefact. This enables authoring and model repository tools to track artefacts as they are modified over time.</p>
</li>
<li>
<p>other GUIDs can be used to identify finer level snapshots of changed artefacts;</p>
</li>
<li>
<p>one or more namespaced HRIDs for an artefact can be computed from various properties of the artefact. Which properties will depend on the type of artefact.</p>
</li>
<li>
<p>the last committed 'build' of an artefact (i.e. most recent version containing a change, no matter how small) can be identified in two ways:</p>
</li>
<li>
<p>using a 'build' number that is part of the version identification of the artefact;</p>
</li>
<li>
<p>via a hash on a canonical serialisation of the artefact.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is a departure from the common situation where no machine identifier is assigned, and the artefact HRID is a static string, rather like a source file filename.</p>
</div>
</div>
<div class="sect2">
<h3 id="_meta_data"><a class="anchor" href="#_meta_data"></a>2.5. Meta-data</h3>
<div class="paragraph">
<p>A solution for identification that includes human readable (formal) identifiers unavoidably implicates the 'meta-data' of the identified artefacts, since such identifiers are normally created from smaller items such as 'reference model class', 'version', 'namespace' and so on. However, some items of meta-data are not appropriate for inclusion in an artefact, and would be created in the Registry instead. A general rule is that this applies to any item of information that may change without affecting the semantics of the artefact, and whose change should not require revision of the artefact itself. Examples of such information: ontological classification(s); 'ownership' status.</p>
</div>
<div class="paragraph">
<p>This specification assumes that an artefact management environment includes such a registry, and that some items of meta-data can be stored outside the artefacts themselves.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_source_artefact_identification"><a class="anchor" href="#_source_artefact_identification"></a>3. Source Artefact Identification</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>3.1. Overview</h3>
<div class="paragraph">
<p>The basis for identifying source (i.e. authored) artefacts is to define a number of separate logically identifying properties, as well as a machine identifier. One or more human-readable identifier(s) can be generated from the non-uid identifying properties. For archetypes and templates, the relevant properties are described in the <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html#_the_archetype_package" target="_blank" rel="noopener">AOM Archetype package</a>, including the <code>ARCHETYPE_HRID</code> class. Related properties are inherited from the <code>AUTHORED_RESOURCE</code> class into <code>ARCHETYPE</code> are shown, including the <code>lifecycle_state</code> property, as well as all other descriptive meta-data.</p>
</div>
<div id="archetype_package" class="imageblock text-center text-center">
<div class="content">
<img src="UML/diagrams/AM-aom2.archetype.svg" alt="AM aom2.archetype">
</div>
<div class="title">Figure 2. am.aom2.archetype Package</div>
</div>
<div class="paragraph">
<p>For other types of artefacts the detailed model will differ, but the principles are the same.</p>
</div>
<div class="paragraph">
<p>Three distinct groups of properties shown in the <code>ARCHETYPE_HRID</code> class that underpin the identification scheme described here, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>namespace</code> provides a way of distinguishing logical identifiers created by different organisations that would otherwise compete in a single semantic identifier space;</p>
</li>
<li>
<p><code>rm_publisher</code>, <code>rm_closure</code>, <code>rm_class</code>, <code>concept_id</code> form the basis of the main part of a human-readable identifier, e.g. <code>openEHR-EHR-OBSERVATION.bp_measurement</code>;</p>
</li>
<li>
<p>properties supporting versioning:</p>
<div class="ulist">
<ul>
<li>
<p><code>release_version</code>, expressing a 3-part version identifier, e.g. '1.3.0';</p>
</li>
<li>
<p><code>build_uid</code> , incremented at every commit, supporting non-release version ids, such as '1.3.0-rc.28' and '1.3.0-alpha', where the build count is 28;</p>
</li>
<li>
<p><code>description</code>.<code>lifecycle_state</code>, expressing the development state of the artefact, and used to derive the 'rc' (release candidate) and 'alpha' (development) parts of non-release version ids.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Functions such as <code>interface_id</code>, <code>physical_id</code> and <code>version_id</code> are defined to return respectively the 'interface' and 'physical' archetype HRIDs (described below) as strings, and the full version string (computed from <code>release_version</code> , <code>build_uid</code> and <code>description.lifecycle_state</code> ). The functions <code>major_version</code> , <code>minor_version</code> and <code>patch_version</code> extract the various parts of the 3-part <code>release_version</code> property.</p>
</div>
<div class="paragraph">
<p>The <code>uid</code> property provides the machine identifier, and is assumed to be a Guid.</p>
</div>
<div class="paragraph">
<p>Both the <code>uid</code> and <code>namespace</code> properties are optional for legacy reasons, since most existing archetypes have neither. The interpretation of an artefact without these identifiers in this specification is that it is <em>unmanaged</em> , i.e. it has no recognised owner organisation. During a period of changeover to the identifiers specified here, there will clearly be artefacts that are in fact managed, and which need to have the <code>uid</code> and <code>namespace</code> properties assigned. This will obviously take some time, as it requires support from the tooling ecosystem.</p>
</div>
<div class="paragraph">
<p>Different types of human-readable identifiers are used for archetypes, templates and terminology subsets. The following sections describe the formal details of this identification scheme, and how it supports referencing between artefacts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_formal_model"><a class="anchor" href="#_formal_model"></a>3.2. Formal Model</h3>
<div class="paragraph">
<p>This section defines a formal grammar for human-readable indentifiers of knowledge artefacts. As described above, more than one human-readable identifier can be constructed from the identifying properties of the <code>ARCHETYPE_HRID</code> class. The grammar is shown in green below.</p>
</div>
<div class="paragraph">
<p>The highest level distinction is between managed and unmanaged artefacts, with managed status being indicated by the prepending of a namespace to what can be termed a 'local' HRID (i.e. local to a given namespace context).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">artefact_hrid           </span><span class="tok-o">=</span>   <span class="tok-k">namespaced_hrid </span><span class="tok-p">|</span> <span class="tok-k">local_hrid </span><span class="tok-p">;</span>
    <span class="tok-k">namespaced_hrid         </span><span class="tok-o">=</span>   <span class="tok-k">namespace </span><span class="tok-s1">&#39;::&#39;</span> <span class="tok-k">local_hrid </span><span class="tok-p">;</span>
    <span class="tok-k">local_hrid              </span><span class="tok-o">=</span>   <span class="tok-k">hrid_root </span><span class="tok-s1">&#39;.v&#39;</span> <span class="tok-k">version_id </span><span class="tok-p">;</span>
    <span class="tok-k">namespace               </span><span class="tok-o">=</span>   <span class="tok-k">V_REVERSE_DOMAIN_NAME </span><span class="tok-p">;</span>
    <span class="tok-k">V_REVERSE_DOMAIN_NAME   </span><span class="tok-o">=</span>   <span class="tok-p">;</span> <span class="tok-cm">(* See IETF RFCs 1035, 123, and 2181. *)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>namespace</code> above is the publisher organisation reverse domain name. Reverse domain names are used in order to aid lexical sorting of identifiers and also tools that build directory structures based on reverse domain name segments. All managed artefacts, including archetypes and templates should include a namespace. Any archetype or template carriying an identifier without a namespace is assumed to be an unmanaged artefact.</p>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr</code> : EHR archetypes library at openEHR.org</p>
</li>
<li>
<p><code>uk.nhs</code>      : UK National Health Service</p>
</li>
<li>
<p><code>edu.nci</code>     : US National Cancer Institute</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_human_readable_identifier_hrid"><a class="anchor" href="#_human_readable_identifier_hrid"></a>3.2.1. Human-readable Identifier (HRID)</h4>
<div class="paragraph">
<p>The archetype human-readable identifier consists of two logical parts: an identifier of the reference model (i.e. logical information model) class on which it is based, and an ontological identifier.</p>
</div>
<div class="paragraph">
<p>The identifier is defined by the following grammar rules, which are a slightly simplified version of the grammar for the <a href="https://specifications.openehr.org/releases/BASE/latest/base_types.html#_identification_package" target="_blank" rel="noopener">openEHR <code>ARCHETYPE_ID</code> type</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">hrid_root                       </span><span class="tok-o">=</span>   <span class="tok-k">qualified_rm_class_name </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">concept_id </span><span class="tok-p">;</span>
    <span class="tok-k">qualified_rm_class_name         </span><span class="tok-o">=</span>   <span class="tok-k">rm_publisher </span><span class="tok-s1">&#39;-&#39;</span> <span class="tok-k">rm_closure </span><span class="tok-s1">&#39;-&#39;</span> <span class="tok-k">rm_class </span><span class="tok-p">;</span>
    <span class="tok-k">rm_publisher                    </span><span class="tok-o">=</span>   <span class="tok-k">V_ALPHANUMERIC_NAME </span><span class="tok-p">;</span>
    <span class="tok-k">rm_closure                      </span><span class="tok-o">=</span>   <span class="tok-k">V_ALPHANUMERIC_NAME </span><span class="tok-p">;</span>
    <span class="tok-k">rm_class                        </span><span class="tok-o">=</span>   <span class="tok-k">V_ALPHANUMERIC_NAME </span><span class="tok-p">;</span>
    <span class="tok-k">concept_id                      </span><span class="tok-o">=</span>   <span class="tok-k">V_SEGMENTED_ALPHANUMERIC_NAME </span><span class="tok-p">;</span>

    <span class="tok-k">V_ALPHANUMERIC_NAME             </span><span class="tok-o">=</span>   <span class="tok-ni">? [a-zA-Z][a-zA-Z0-9_]+ ?</span> <span class="tok-p">;</span>  <span class="tok-cm">(* regex *)</span>
    <span class="tok-k">V_SEGMENTED_ALPHANUMERIC_NAME   </span><span class="tok-o">=</span>   <span class="tok-ni">? [a-zA-Z][a-zA-Z0-9_-]+ ?</span> <span class="tok-p">;</span> <span class="tok-cm">(* allows hyphens *)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The field meanings are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rm_publisher</code>: id of organisation originating the reference model on which this archetype is based;</p>
</li>
<li>
<p><code>rm_closure</code>: identifier of the reference model top-level package closure on which the archetype is based;</p>
</li>
<li>
<p><code>rm_class</code>: name of class or equivalent entity in the reference model on which the artefact is based;</p>
</li>
<li>
<p><code>concept_id</code>: an identifier from an ontology of information artefacts (see below);</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first part takes the form of a 3-part identifier, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>openEHR-EHR-EVALUATION</code></p>
</li>
<li>
<p><code>ISO-ISO13606-ENTRY</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This historically has been used in openEHR and CEN/ISO 13606-2 to identify the reference model class on which an archetype is based. It includes the publisher of the reference model (e.g. "ISO", "openEHR"), which top level 'closure' is being referred to, and finally which class.</p>
</div>
<div class="paragraph">
<p>The notion of 'closure' is a top level package from which the focal class can be reached. In general, a given class can be reached from more than one top level package, but an archetype of that class will only be suitable for one of those packages. For example, the openEHR class <code>CLUSTER</code> is used by classes in both the <code>ehr</code> and <code>demographic</code> top level packages. However, an archetype of <code>CLUSTER</code> will usually be designed for use with only one of those packages. The Cluster archetype <code>physical_examination</code> for example will only make sense in data defined by the <code>ehr</code> package. Consequently, it will have an archetype identifier of the form <code>openEHR-EHR-CLUSTER</code> . <code>physical_examination</code> .</p>
</div>
<div class="paragraph">
<p>The closure part of the identifier could be used by tools to ensure for example that an 'EHR' <code>CLUSTER</code> archetype was never attached to a 'demographic' information item.</p>
</div>
<div class="sect4">
<h5 id="_concept_identifier"><a class="anchor" href="#_concept_identifier"></a>3.2.1.1. Concept Identifier</h5>
<div class="paragraph">
<p>The second part of the human-readable identifier is a 'short' ontological identifier (known in ADL 1.4 as the 'concept' or 'domain concept'). Such identifiers have historically been natural language words or phrases, typically in a short mnemonic form, e.g. 'bp_measurement' in the archetype identifier <code>ISO-ISO13606-ENTRY.bp_measurement.v1</code> .</p>
</div>
</div>
<div class="sect4">
<h5 id="_legacy_adl_1_4_semantics"><a class="anchor" href="#_legacy_adl_1_4_semantics"></a>3.2.1.2. Legacy ADL 1.4 Semantics</h5>
<div class="paragraph">
<p>Historically in ADL 1.4 (ISO 13606-2:2008), the 'concept' part of the identifier encoded the specialisation hierarchy of concepts as a series of hyphated segments, e.g. 'problem' and 'problem-diagnosis', with the latter identifiying a specialised form of the former.The requirement for the concept name to include specialisations is removed in this specification, as well as the ADL / AOM 1.5 specifications. This enables the domain concept of any artefact to be freely assigned according to the purpose of the artefact.</p>
</div>
<div class="paragraph">
<p>To allow for the fact that legacy specialised archetypes do in fact include the '-' style of separated domain concept identifier, the '-' character is still be allowed, but no longer has any semantic significance.</p>
</div>
<div class="paragraph">
<p>One consequence is that for archetypes with identifiers conforming to this specification, the level of specialisation can no longer be determined from the identifier. This new approach is in line with how source artefacts are named in object-oriented languages.</p>
</div>
</div>
<div class="sect4">
<h5 id="_concept_identifier_semantics"><a class="anchor" href="#_concept_identifier_semantics"></a>3.2.1.3. Concept Identifier Semantics</h5>
<div class="paragraph">
<p>The more important aspect of the concept identifier, is its origin and semantics. Historically it has been part of the identifier for archetypes because it is human readable and facilitates debugging of systems where the data contain such identifiers. Clearly a purely ad hoc assignment of a human-readable identifier is not scalable or reliable. Consequently rules and mechanisms for assignment need to be identified.</p>
</div>
<div class="paragraph">
<p>This specification takes the point of view that the concept part of a managed knowledge artefact identifier must come from an ontology corresponding to the namespace of the identifier, in other words, an ontology maintained by a Custodian Organisation or some higher authority.</p>
</div>
<div class="paragraph">
<p>It is not the business of this specification to define the ontology, but we can indicate the general form as being an ontology of information entity types for use in the domain of health. It is assumed that there are nodes within the ontology are related to the classes from the information (i.e. 'reference') model. This leads to an ontology of the form shown below.</p>
</div>
<div id="info_artefact_ontology" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/information_artefact_ontology.png" alt="information artefact ontology" width="70%">
</div>
<div class="title">Figure 3. Information Artefact Ontology</div>
</div>
<div class="paragraph">
<p>This (putative) ontology consists of high-level health information recording entities (black), a set of record entry types derived from the Clinical Investigator Record ontology <span class="citation">(<a href="#Beale_Heard2007">Beale &amp; Heard&#44; 2007</a>)</span>, and domain-specific entities in blue. It is assumed that the top node(s) of the ontology could be related to nodes in a published ontology such as the <a href="https://bioportal.bioontology.org/ontologies/IAO" target="_blank" rel="noopener">Information Artefact Ontology (IAO)</a>, but this is not a pre-requisite for establishing this ontology. More ideally, its categories would be related to categories in the <a href="https://basic-formal-ontology.org" target="_blank" rel="noopener">Basic Formal Ontology (BFO)</a>.</p>
</div>
<div class="paragraph">
<p>The blue node <code>measurement_of_systemic_arterial_blood_pressure</code> (bottom left) describes an entity corresponding to a 'record of systemic arterial blood pressure measurement'. Long names such as this are standard in the ontology community, and are designed to ensure that the name of a category is sufficient to unamiguously define its meaning. Such names are typically too long and unwieldy for the purposes of managable lexical identifiers such as for archetypes.</p>
</div>
<div class="paragraph">
<p>We therefore assume that a system of 'short identifiers' is possible within the ontology, where a 'short id' is a synonym for a full node identifier. If we further assume that the ontology is constructed with tools (e.g. <a href="http://protege.stanford.edu/" target="_blank" rel="noopener">Protege</a>) and that ontology identifiers are checked to ensure uniqueness.</p>
</div>
<div class="paragraph">
<p>Facilities to manage such ontologies should be available either centrally (e.g. openEHR.org or at The <a href="http://www.obofoundry.org/" target="_blank" rel="noopener">Open Biological and Biomedical Ontologies (OBO)</a>), so that every added archetype, template or subset is assigned a short ontological identifier from the ontology.</p>
</div>
<div class="paragraph">
<p>Existing archetypes can be accommodated within such ontologies in two possible ways. If they have been in use, and data exist containing these identifiers, then their current ontological identifiers can be proposed as the short id for an ontology class defined for the archetype. If there is a clash, a new archetype concept short identifier will be needed, and the archetype will need to be republished under a different identifier.</p>
</div>
</div>
<div class="sect4">
<h5 id="_need_for_rm_class_name_in_identifier"><a class="anchor" href="#_need_for_rm_class_name_in_identifier"></a>3.2.1.4. Need for RM Class Name in Identifier</h5>
<div class="paragraph">
<p>Theoretically, the Reference Model class identifier part (qualified_rm_class_name above) should not be needed in a well constructed identifier, on the basis that there should never be a clash of concept identifiers, regardless of the RM class, even though they can easily be similar. For example, a reasonable <code>concept_id</code> for an <code>ENTRY</code> (ISO 13606) or <code>OBSERVATION</code> (openEHR) structure archetyped to represent a generic lab result result might be 'lab_result'. For the COMPOSITION-level archetype designed to contain any 'lab result' <code>ENTRY</code> or <code>OBSERVATION</code>, a reasonable name would typically be 'lab_report' (or the equivalent in another language).</p>
</div>
<div class="paragraph">
<p>Unfortunately, for some informational concepts, the appropriate name for the actual core data level can appear to be perfectly reasonable also as a name for a higher level container of the same data. Without an efficient and essentially global ontology construction service or authority available, the inclusion of the qualified RM class name acts as a reasonable guard against such clashes.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_versioning"><a class="anchor" href="#_versioning"></a>4. Versioning</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_general_model"><a class="anchor" href="#_general_model"></a>4.1. General Model</h3>
<div class="paragraph">
<p>Unlike software artefacts in most modern versioning systems, knowledge artefacts are <em>individually</em> version-controlled. This is because an archetype, template or terminology subset is, in and of itself, a potentially complex structure of data points / groups and / or terminology codes and relationships. It can in general be used on its own or with a small number of related artefacts (e.g. specialisation parents). Therefore, the version identification system applies to <em>each source artefact</em>, rather than an entire repository in the manner of typical software versioning.</p>
</div>
<div class="paragraph">
<p>This has a very visible effect: it means that every 'committed' change to an artefact is like a release, whereas with software, numerous changes to source files typically occur between releases. Additionally, each artefact revision is <em>distinguished by its version identifier</em> for the purpose of change tracking in a repository environment, whereas with software source artefacts, the logical 'name' of each entity (e.g. a class called 'LinkedList') within the source repository doesn&#8217;t change, even though its contents do. To summarise:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>software versioning is performed by successive snapshots of a repository, and releasing is performed by assigning a version identifier to some of the snapshots;</p>
</li>
<li>
<p>for knowledge artefacts being described here, versioning occurs <em>independently</em> for each artefact, and 'releasing' is simply an act of publishing the artefact;</p>
</li>
<li>
<p>for knowledge artefacts, the versioned human-readable identifier is or can be used computationally, e.g. in queries and artefact references, whereas a software release identifier is not generally computed on by the software itself.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_version_numbering"><a class="anchor" href="#_version_numbering"></a>4.2. Version Numbering</h3>
<div class="paragraph">
<p>Despite the above differences, the numbering of versions of knowledge artefacts follows the rules for identifying software releases described by <a href="http://semver.org">semver.org</a>.</p>
</div>
<div class="paragraph">
<p>Accordingly, version identifiers are based on three levels of 'versioning', identified by dot-separated numeric parts, with an optional extension related to the artefact lifecycle, described below. The numeric parts are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>major version</strong> - must be incremented with a breaking change to the artefact formal definition; may be incremented with a lesser change;</p>
</li>
<li>
<p><strong>minor version</strong> - must be incremented with a non-breaking change to the artefact formal definition; may be incremented with a lesser change;</p>
</li>
<li>
<p><strong>patch version</strong> - must be incremented with a change to the informal parts of the artefact;</p>
</li>
<li>
<p><strong>build number</strong> - a number that is incremented every time an artefact is committed, and is reset to 1 whenever the version id is changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the above, the 'formal definition' refers to the following parts of an archetype or template only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the identifier section;</p>
</li>
<li>
<p>the <code>specialize</code> clause;</p>
</li>
<li>
<p>the <code>definition</code> section;</p>
</li>
<li>
<p>within the <code>terminology</code> section:</p>
</li>
<li>
<p>the <code>text</code> short names of the terms in the <code>term_definitions</code> section (i.e. not the description long text or other meta-data);</p>
</li>
<li>
<p>the <code>term_bindings</code> section;</p>
</li>
<li>
<p>the <code>value_set</code> section.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lexically, the version identifier is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">version_id        </span><span class="tok-o">=</span>   <span class="tok-k">release_version </span><span class="tok-p">[</span> <span class="tok-k">extension </span><span class="tok-p">]</span> <span class="tok-p">;</span>
    <span class="tok-k">release_version   </span><span class="tok-o">=</span>   <span class="tok-k">major_version </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">minor_version </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">patch_version </span><span class="tok-p">;</span>
    <span class="tok-k">major_version     </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">V_NUMBER </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">minor_version     </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">V_NUMBER </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">patch_version     </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">V_NUMBER </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">extension         </span><span class="tok-o">=</span>   <span class="tok-k">version_modifier </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">issue_number </span><span class="tok-p">;</span>
    <span class="tok-k">version_modifier  </span><span class="tok-o">=</span>   <span class="tok-s1">&#39;-rc&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;-alpha&#39;</span> <span class="tok-p">;</span>
    <span class="tok-k">issue_number      </span><span class="tok-o">=</span>   <span class="tok-k">V_NUMBER </span><span class="tok-p">;</span>
    <span class="tok-k">V_NUMBER          </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">V_DIGIT </span><span class="tok-p">}</span><span class="tok-err">+</span> <span class="tok-p">;</span>
    <span class="tok-k">V_DIGIT           </span><span class="tok-o">=</span>   <span class="tok-s1">&#39;0&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;1&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;2&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;3&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;4&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;5&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;6&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;7&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;8&#39;</span> <span class="tok-p">|</span> <span class="tok-s1">&#39;9&#39;</span> <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This leads to identifiers such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    1.3.5-alpha         # alpha development version based on version 1.3.4
    1.3.5-rc.3          # release candidate for version 1.3.5, issue 3
    1.3.5               # release 1.3.5</pre>
</div>
</div>
<div class="paragraph">
<p>The following general rules are required for using version identifiers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>First version rule</strong>: the first version (i.e. version on creation) of an artefact is a <code>v0</code> version, i.e. <code>0.N.P</code>. Usually it is <code>0.0.1</code>, but may be a higher <code>v0</code> version to indicate maturity. The discussion of lifecycle and distributed semantics below provide more details on the initial version semantics.</p>
</li>
<li>
<p><strong>Incrementing rule</strong>: when generating a release version (i.e. not a candidate or alpha version), when the major version is incremented, the minor and patch version numbers are reset to 0; when the minor version is incremented, the path number is reset to 0.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More specific rules relating to specific lifecycle states are described below.</p>
</div>
<div class="paragraph">
<p>Two 'variant' versions are defined in the above syntax: 'release candidate' and 'alpha'. The first is a standard software classification, syntactically indicated with the tag <code>rc</code>. Version numbers including <code>rc</code> are always of the form <code>M.N.P-rc.B</code>, e.g. <code>1.3.5-rc.1</code>, where the minus sign (<code>-</code>) is understood as indicating a version that is 'prior to' the target version <code>1.3.5</code>, i.e. <code>1.3.5-rc.1</code> is an interim version leading to the stable version <code>1.3.5</code>.</p>
</div>
<div class="paragraph">
<p>The other variant is indicated with the modifier <code>-alpha</code>, where <code>-</code> has the same meaning as above (i.e. indicates a version prior to the version identified by the preceding numeric identifier), and <code>alpha</code> indicates an 'alpha' development version. The magnitude of the differences in a <code>-alpha</code> version are indicated by the difference between the 3-part version identifiers of the current artefact and the previously published one on which it is based.</p>
</div>
<div class="paragraph">
<p>Note that only the major version forms part of the source artefact human-readable identifier. The intention of that is that a breaking change causes a new artefact from the point of view of deployment. This is analagous to breaking changes in software interfaces, web service definitions etc, being seen as a distinct entity, typically deployed alongside the previous version(s).</p>
</div>
</div>
<div class="sect2">
<h3 id="_change_semantics"><a class="anchor" href="#_change_semantics"></a>4.3. Change Semantics</h3>
<div class="paragraph">
<p>As a consequence of the 3-part <a href="http://semver.org">semver.org</a> version identification scheme, three levels of change to an artefact can be distinguished. The main question for archetype authors and tool developers is: what level of version change is <em>required</em> for a given kind of concrete change to the artefact? Is this change a patch, a minor version or a breaking change (i.e. major version)?</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There is no assumption that a change of a given technical level (i.e. as evaluated by a diff tool) will be seen equivalently by domain experts. For example a minor change that only requires the patch version to be incremented might have major implications for clinical semantics. For this reason, the version identifier may be incremented beyond the minimum level required by a mechanical comparison.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Accordingly, the rules below define the <em>minimum necessary level of version change</em>, not the mandated level, which may always be higher.</p>
</div>
</div>
<div class="sect2">
<h3 id="_versionable_interface_for_archetypes"><a class="anchor" href="#_versionable_interface_for_archetypes"></a>4.4. Versionable 'interface' for archetypes</h3>
<div class="paragraph">
<p>The Semver model is designed for software, and is based on the concept of the software interface, or 'public API'. An API consists of a set of formal method signatures of routines that that client software can call. A given component of client software will be valid against a given API if all the calls (including all details of routine names, arguments, return values and types) it contains for that API do actually exist in the API. The semantics of the API should also be respected: two functions called respectively <code><em>names</em></code> and <code><em>addresses</em></code> might both return a <code>List&lt;String&gt;</code> value, but clearly for the API&#8217;s meaning to be preserved over versions, the contents must be name and address information, not something else (e.g. address and name values, reversed).</p>
</div>
<div class="paragraph">
<p>In a similar way, for an archetype or template, the idea of 'interface' can be related to an 'archetype signature', which we can define as follows.</p>
</div>
<div class="paragraph definition">
<p>Archetype signature &#x225d;    Set of <code>&lt;path, RM type, AOM constraint&gt;</code> for every definition node in the archetype.</p>
</div>
<div class="paragraph">
<p>The paths, RM types and formal constraints are what other system components assume about an archetype, and what must therefore be maintained for a non-breaking change.</p>
</div>
<div class="paragraph">
<p>Consider first the paths. An archetype path is a formal path through a hierarchical structure whose nodes are named by Reference Model class attributes, and in the case of object nodes, by at-codes (id-codes). Any given path must be a legal path through an instance structure constructable by the Reference Model on which it is based. This implies two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the order and naming of nodes down the hierarchy is determined by the RM;</p>
</li>
<li>
<p>the type of every object is determined by the RM;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further, each node is made unique by the use of archetype at-codes (id-codes) (in ADL 1.4 at-codes) which distinguish sibling child objects under any attribute node. Where there are siblings (there need not always be), these codes must be defined in the archetype terminology by domain semantic definitions (e.g. 'serum sodium', 'O2 saturation level').</p>
</div>
<div class="paragraph">
<p>Typical archetype paths look as follows:</p>
</div>
<div id="typical_paths" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/paths.png" alt="paths" width="90%">
</div>
<div class="title">Figure 4. Typical Paths</div>
</div>
<div class="paragraph">
<p>The RM attribute names and node at-codes (id-codes) are visible within the paths (left-hand column). The node RM types implied in the paths are shown in the middle column. The first path thus corresponds to the object model reference <code>OBSERVATION</code>.<code><em>data._events.data.items</em></code>, and happens to be of type <code>ITEM</code>.</p>
</div>
<div class="paragraph">
<p>We can show the highlighted path with code rubrics included:</p>
</div>
<div class="listingblock">
<div class="title">at-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-p">/</span><span class="tok-nc">data</span><span class="tok-p">[</span><span class="tok-nd">at0001</span><span class="tok-p">]/</span><span class="tok-nc">events</span><span class="tok-p">[</span><span class="tok-nd">at0002</span><span class="tok-p">|</span><span class="tok-s">Any event</span><span class="tok-p">|]/</span><span class="tok-nc">data</span><span class="tok-p">[</span><span class="tok-nd">at0003</span><span class="tok-p">]/</span><span class="tok-nc">items</span><span class="tok-p">[</span><span class="tok-nd">at0078.11</span><span class="tok-p">|</span><span class="tok-s">PaO2</span><span class="tok-p">|]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">id-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-p">/</span><span class="tok-nc">data</span><span class="tok-p">[</span><span class="tok-nd">id2</span><span class="tok-p">]/</span><span class="tok-nc">events</span><span class="tok-p">[</span><span class="tok-nd">id3</span><span class="tok-p">|</span><span class="tok-s">Any event</span><span class="tok-p">|]/</span><span class="tok-nc">data</span><span class="tok-p">[</span><span class="tok-nd">id4</span><span class="tok-p">]/</span><span class="tok-nc">items</span><span class="tok-p">[</span><span class="tok-nd">id79.11</span><span class="tok-p">|</span><span class="tok-s">PaO2</span><span class="tok-p">|]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>at0078.11</code> (<code>id79.11</code>) is defined as 'PaO2', for which the description is 'Oxygen partial pressure in arterial blood'. This defined the domain meaning of the node at this path.</p>
</div>
<div class="paragraph">
<p>Paths and types constitute the structure of the archetype. In addition, the constraints (as defined by the Archetype Object Model) at each node - other than RM types - must be taken into account. These consist of constraints on values, cardinalities and occurrences.</p>
</div>
<div class="sect3">
<h4 id="_interface_preservation"><a class="anchor" href="#_interface_preservation"></a>4.4.1. Interface preservation</h4>
<div class="paragraph">
<p>Semver-style versioning relies on the notion of <em>interface conformance</em> between putative versions of the same logical artefact. Based on the above, we can say that <em>an archetype interface is preserved</em> if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for an existing path, nothing changes - no change in hierarchy or lexical at-code (id-code);</p>
</li>
<li>
<p>in the path set, no paths are deleted;</p>
</li>
<li>
<p>no change in domain meaning for at-codes (id-codes) used in the path;</p>
</li>
<li>
<p>RM type of object nodes is the same or an ancestor (i.e. super-type) of the original type;</p>
</li>
<li>
<p>the constraint(s) at each path are either identical or wider than the original.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can use this as the basis for determining required version changes for different types of concrete change to an archetype.</p>
</div>
</div>
<div class="sect3">
<h4 id="_major_version_breaking_changes"><a class="anchor" href="#_major_version_breaking_changes"></a>4.4.2. Major version (breaking) changes</h4>
<div class="paragraph">
<p>A breaking change for an archetype is defined as one that fails to preserve the archetype interface, in the sense defined above. Practically, this will be any change that prevents data created by the previous release of the artefact validating against the new version.</p>
</div>
<div class="paragraph">
<p>Examples of breaking changes are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>removal of mandatory data points or groups;</p>
</li>
<li>
<p>removal of nodes (paths);</p>
</li>
<li>
<p>move of nodes to different sub-tree;</p>
</li>
<li>
<p>change of domain definition of at-code (id-code);</p>
</li>
<li>
<p>narrowing of any constraint, including RM type of a node.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any such change necessarily requires a new major version.</p>
</div>
</div>
<div class="sect3">
<h4 id="_minor_version_changes"><a class="anchor" href="#_minor_version_changes"></a>4.4.3. Minor version changes</h4>
<div class="paragraph">
<p>In the Semver approach to versioning, a 'minor' version is used to indicate a non-breaking enhancement to the 'interface', as described above.</p>
</div>
<div class="paragraph">
<p>For archetypes this can be interpreted as being the following kinds of change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>constraints, including node RM types, redefined to be 'wider' (i.e. old constraint subsumed by new constraint);</p>
</li>
<li>
<p>additional definition nodes (i.e. new paths);</p>
</li>
<li>
<p>the addition of terminology bindings.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Technically speaking, the addition of terminology bindings could be regarded as a patch-level change, however, its importance in practical use is usually such that a minor version would be warranted.</p>
</div>
<div class="paragraph">
<p>This has the important side-effect that minor versions of a given major version may have additional semantics comared to the original major version (i.e, minor version 0) and any other intervening minor version. In other words, <strong>specifying a major version in general may not be sufficient to designate all of the interface available</strong> in the latest minor version. Therefore, for purposes of referencing an artefact with the expectation that the reference will designate specific elements, at least a minor version may be needed. This is discussed further in <a href="#_referencing">Section 7</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_patch_version_changes"><a class="anchor" href="#_patch_version_changes"></a>4.4.4. Patch version changes</h4>
<div class="paragraph">
<p>Numerous other kinds of change are possible on an archetype which will require at least a change in the patch (3rd position) version number. These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>changes to meta-data;</p>
</li>
<li>
<p>addition of language translations;</p>
</li>
<li>
<p>changes to wording of terminology that do not affect the sense of the definition, or the use of the term by users.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lifecycle_model"><a class="anchor" href="#_lifecycle_model"></a>5. Lifecycle Model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_conceptual_model"><a class="anchor" href="#_conceptual_model"></a>5.1. Conceptual Model</h3>
<div class="paragraph">
<p>As with software, knowledge artefacts follow a lifecycle with identified states, representable by a state diagram. A traversal through the state diagram corresponds to the development of changes to an artefact leading to a release of a specific version.</p>
</div>
<div class="paragraph">
<p>Although somewhat peripheral to the scope of artefact identification, we describe a 'de facto' lifecycle for three reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to provide at least one lifecycle definition for users who have no other definition available;</p>
</li>
<li>
<p>to provide explicit terminology for states and transitions for use in this and other specifications;</p>
</li>
<li>
<p>to concretise the relationship between versioning and state transitions that commonly occur in software and other formal artefact development.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The lifecycle defined here is shown below.</p>
</div>
<div id="development_lifecycle" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/development_lifecycle.png" alt="development lifecycle" width="80%">
</div>
<div class="title">Figure 5. Development Lifecycle</div>
</div>
<div class="paragraph">
<p>A multi-level model is used, where some states have 'micro-states', and top-level states are known as 'macro-states'. The intention is to provide standard names for all macro-states, while suggesting and allowing micro-states where they make sense. Macro-state names are the basis for software version identification - 'development' corresponds to the <code>-alpha</code> variant, 'release_candidate' to the <code>-rc</code> variant. Micro-states are useful to indicate because they define names for finer-grain states typically supported in artefact repositories.</p>
</div>
<div class="paragraph">
<p>This lifecycle assumes that artefacts start life either in an 'unmanaged' environment or directly in a managed one. In the latter case, it is assumed that there is some distinction between the developers' view and the 'release' view.</p>
</div>
<div class="paragraph">
<p>The key states are defined with names (dark blue) and transitions (light blue) that correspond to typical software and document development terms. Typical traversals through the lifecycle are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>[ <code>unmanaged</code> &#8594; ] <code>development</code> &#8594; <code>published</code></p>
</li>
<li>
<p><code>development</code> &#8230;&#8203; <code>development</code> &#8594; <code>release_candidate</code> &#8594; &#8230;&#8203; <code>release_candidate</code> &#8658; <code>published</code></p>
</li>
<li>
<p><code>published</code> &#8594; <code>deprecated</code></p>
</li>
<li>
<p><code>development</code> &#8594; <code>rejected</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A few linguistic conventions used here are worth noting:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>start_review</code> is the name of all actions entering the <code>development</code> macro-state;</p>
</li>
<li>
<p><code>release</code> as an action (i.e. state transition) is taken to mean making any version of an artefact available to the public user base, including pre-releases, final releases and post-releases ('builds' in <a href="http://semver.org">semver.org</a> parlance);</p>
</li>
<li>
<p><code>publish</code> as an action means to make a definitive release.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lifecycle_based_versioning"><a class="anchor" href="#_lifecycle_based_versioning"></a>5.2. Lifecycle-based Versioning</h3>
<div class="paragraph">
<p>The correspondence of versioned human-readable identifier and lifecycle states can now be described, according to the illustration below.</p>
</div>
<div id="development_lifecycle_with_versioning" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/development_lifecycle_with_versioning.png" alt="development lifecycle with versioning" width="80%">
</div>
<div class="title">Figure 6. Development Lifecycle with Versioning</div>
</div>
<div class="paragraph">
<p>The version identifier evolves according to the general rules described above, and specific rules related to the lifecycle states, as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An artefact normally starts life at <code>0.0.1</code>, although it is acceptable practice to start at some other v0 version e.g. <code>0.5.0</code> to indicate approximately how mature the artefact is. It remains as a <code>v0.x</code> version for a period of unstable early development leading to an initial releasable <code>1.x</code> version.</p>
</li>
<li>
<p>At some point, the artefact will be uploaded to a managed repository, at which point its identifier will be prepended with the management organisation namespace (and may change in other ways) and will have <code>-alpha</code> appended.</p>
</li>
<li>
<p>During initial 'v0' development, an artefact is considered to be unstable, i.e. any kind of changes may be made, reversed, redone and so on; due to this, the minor and patch version numbers are updated freely, and typically less often than the rules dictate for post-v0 development.
is formed from the next version number that corresponds to the magnitude of the changes currently in the artefact, and appended with <code>-alpha</code>.</p>
</li>
<li>
<p>An artefact may be rejected, in which case the artefact lifecycle state is set to <code>rejected</code> (the version identifier is not changed).</p>
</li>
<li>
<p>At some point, the authoring team of an artefact will decide the artefact is ready for release. Its release version id is either <code>v1.0.0</code>, or else calculated as a function of the difference between the current form and the base version on which it is based.</p>
</li>
<li>
<p>It is then either:</p>
<div class="ulist">
<ul>
<li>
<p>published into a pre-release cycle, at which point the numerical part of the version is computed according to the difference between the current form of the artefact and the release version on which it is based. The form of the identifer becomes <code>M.N.P-rc.B</code>, which indicates a community testing phase. From the <code>release_candidate</code> state, three paths are possible:</p>
<div class="ulist">
<ul>
<li>
<p>publish definitively with a stable version id of the form <code>M.N.P</code>;</p>
</li>
<li>
<p>release a newer release candidate, containing only changes that do not break the interface, i.e. patch-level changes or less; update the instance UID in any case;</p>
</li>
<li>
<p>if larger changes are needed, go back into the <code>development</code> state and perform larger changes as needed;</p>
</li>
</ul>
</div>
</li>
<li>
<p>released directly to a stable version of the form <code>M.N.P</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>An artefact may eventually be deprecated, in which case the artefact lifecycle state is set to 'deprecated' (the version identifier is unchanged). It may be classified inside the repository registry as <code>obsolete</code>, <code>suspended</code> or in some other way.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>According to the basic version rules and the lifecycle model above, the 'precedence' of version identifiers follows is exemplified by the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    1.2.3-rc.1 &lt; 1.2.3-rc.2 &lt; 1.2.3 &lt; 1.2.4-alpha &lt; 1.3.0-alpha &lt; ... &lt; 1.3.0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distributed_governance"><a class="anchor" href="#_distributed_governance"></a>6. Distributed Governance</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_3"><a class="anchor" href="#_overview_3"></a>6.1. Overview</h3>
<div class="paragraph">
<p>This section deals with how knowledge artefact identifiers are managed in the distributed environment illustrated in <a href="#distributed_development_environment">Figure 1</a>. Rules are needed to define how identifiers are managed in the event of an artefact coming under management, as well as transfers and forking of managed artefacts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_management"><a class="anchor" href="#_management"></a>6.2. Management</h3>
<div class="paragraph">
<p>Many knowledge artefacts start life in an ad hoc way, created by a research project or expert individual. From the point of view of this specification, they are initially 'umanaged', meaning they have no custodial organisation.</p>
</div>
<div class="paragraph">
<p>The first step to making an artefact widely visible, and usable to the outside world is to bring it under management of an organisation that follows rules of governance and quality assurance on which the outside world can rely. This specification does not describe all these rules, just the rules for identification and meta-data of artefacts coming under management.</p>
</div>
<div class="paragraph">
<p>When an artefact is first created, its lifecycle state is 'unmanaged' and its version identifier is <code>v0.N.P</code>, i.e. a 'pre- v1' version, generally recognised (e.g. by the Github <a href="http://semver.org">Semantic Versioning guidelines</a> as being an unstable form of the artefact that makes no promises with respect to the normal major/minor/patch versioning rules. The artefact may be given a Guid by tooling, although this will be ignored by a management organisation due to the fact that Guids assigned by ad hoc tools or direct human authoring are often copies of existing Guids (due to cut and paste) or are unreliable in some other way (improper Guid algorithm implementation).</p>
</div>
<div class="paragraph">
<p>When an artefact is accepted by a Custodian Organisation, the following things happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>its lifecycle state progresses to <code>initial</code>;</p>
</li>
<li>
<p>its human-readable identifier is changed to the namespaced form;</p>
</li>
<li>
<p>it is assigned a newly generated Guid as its uid;</p>
</li>
<li>
<p>if its major version number is higher than 0 it is reset to <code>0.0.1</code>, otherwise it is left unchanged;</p>
</li>
<li>
<p>various meta-data items are set, including copyright, license.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, a SHA-1 hash may be generated for the artefact, which is stored within the repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transfer_and_forking"><a class="anchor" href="#_transfer_and_forking"></a>6.3. Transfer and Forking</h3>
<div class="paragraph">
<p>Once an artefact is under management, it evolves according to the lifecycle described earlier in this specification. Most of these steps and transitions can be considered 'details of development'. However, when an artefact is deployed, data will be created containing the artefact identifiers, and from this point, the ability to link data to the generating artefacts reliably is the critical issue. The standard approach to this is described in the next section.</p>
</div>
<div class="paragraph">
<p>Challenges in data / artefact identification arise from the transfer and/or 'forking' of artefacts among Custodian Organisations. Artefacts can have two possible roles in a management organisation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>as actively developed and maintained artefacts;</p>
</li>
<li>
<p>as deployment artefacts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Custodian Organisation may decide to cease its own maintenance of an artefact, and transfer that responsibility to another organisation, e.g. a national level CO. Usually it will continue to use the current local form of the artefact in its current deployment contexts, e.g. by local hospital systems or vendors.</p>
</div>
<div class="paragraph">
<p>At the moment of acquisition by the new CO, the artefact&#8217;s HRID would potentially be re-assigned.</p>
</div>
<div class="paragraph">
<p>At some point the new custodian will perform maintenance work on the artefact, for example releasing a new minor or patch-level version. If such new releases are considered national standards, the <em>original</em> CO will most likely adopt them for use. The question is: how are the new releases of the artefact identified?</p>
</div>
<div class="paragraph">
<p>With respect to the human-readable identifier, two strategies are available: retain the original human-readable identifier, or change it to reflect the new CO. An argument against changing it is that identifier continuity would be preserved, ensuring that archetype references in extant queries and in data, as well as in other archetypes and templates remain valid. If it is assumed that all such references are limited to the original management domain, the size of this problem is known and most likely containable.</p>
</div>
<div class="paragraph">
<p>Arguments for changing the identifier include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a requirement of the new Custodian Organisation to be identified in the artefact; this may be a global expectation of industry as well, e.g. if the new manager is a national organisation, it will clearly be easier for vendors and system managers if the artefacts it releases carry its identifier;</p>
</li>
<li>
<p>the possibility that the original domain continues to create new local releases, perhaps in response to problems experienced locally that require unavoidable locally specific changes;</p>
</li>
<li>
<p>the new CO wants to rename the artefact to fit in better with its own ontological artefact classification;</p>
</li>
<li>
<p>if no data or queries have ever been created using the artefact in question, changing its identifier will have no concrete impact anyway;</p>
</li>
<li>
<p>if the namespace always reflects the current CO, it will be easier to know who to contact for support and other purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second of these points constitutes a 'fork' in software terms, i.e. one line of development becomes two. Common sense would seem to dictate that the likelihood of forking, particularly due to the unforeseen need of dealing with local problems after an artefact has been promoted to a higher management domain, will never be zero, and that it may even be frequent.</p>
</div>
<div class="paragraph">
<p>It also seems reasonable to assume that even if there were no rule or obligation to change the identifier of an artefact when it migrates from one manager to another, that it will occur by mutual consent in some situations anyway.</p>
</div>
<div class="paragraph">
<p>The approach of this specification is therefore that rules must be provided that define how artefact re-identification can be effected, without actually requiring it to be done in any particular situation. Part of the requirement is to establish a machine processable concept of 'artefact equivalence'.</p>
</div>
<div class="paragraph">
<p>Rules for migration are required for both the human-readable identifier and the machine identifier. With respect to the human-readable identifier, any of the following are assumed to be mutable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>namespace</code>: at a minimum this will always change;</p>
</li>
<li>
<p><code>concept_id</code>: the ontological identifier may or may not change, depending on whether the new manager wishes to locate the artefact in a different ontology;</p>
</li>
<li>
<p><em>version identifier</em>: the version identifier will in general change, possibly as a function of whether the concept part of the identifier changes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The general case is that the transfer of an artefact to another management organisation may result in an identifier that changes in all aspects apart from the reference model related parts of the identifier, which cannot change for formal reasons.</p>
</div>
<div class="paragraph">
<p>It is assumed here that when the human-readable identifier changes (no matter how minimally), the uid property must be changed as well. This is to prevent confusion between subsequent new versions of the original with releases of the transferred artefact. A new uid is further justified by the unavoidable 'migration is forking' assumption.</p>
</div>
<div class="paragraph">
<p>To enable tools to determine what archetypes are equivalent, a specific section of the artefact meta-data is proposed, which records the equivalence between the current identifier and previous ones. Assuming that an artefact could migrate more than once in its life, this section would need to accommodate multiple such statements. For purposes of helping human use of this information, it is also proposed that a date be included. The section would therefore have the logical structure of a history of equivalences, as shown in the following example for an archetype ('hrid' = human-readable id):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="odin"><span></span><span class="tok-w">    </span><span class="tok-nc">id_history</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-s">&quot;2001-05-27&quot;</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">old</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">                </span><span class="tok-nc">hrid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.com.rbh::openEHR-EHR-EVALUATION.problem_desc.v2.4.1&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">                </span><span class="tok-nc">uid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;5221C9E5-0ECA-469F-83C5-A5D5A0C6682C&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-nc">new</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">                </span><span class="tok-nc">hrid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.gov.nehta::openEHR-EHR-EVALUATION.problem.v1.0.1&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">                </span><span class="tok-nc">uid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;094C8B37-F0CD-45C9-A1B7-CDFDE14C67AB&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-s">&quot;2004-14-03&quot;</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">old</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">                </span><span class="tok-nc">hrid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.gov.nehta::openEHR-EHR-EVALUATION.problem.v1.6.3&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">                </span><span class="tok-nc">uid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;E50290BB-890A-4344-9480-D40AF01C5BCC&quot;</span><span class="tok-err">)</span>
<span class="tok-w">            </span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-nc">new</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">                </span><span class="tok-nc">hrid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.gov.doha::openEHR-EHR-EVALUATION.problem.v1.6.3&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">                </span><span class="tok-nc">uid</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;F4166F58-4EDA-4F13-B413-45A8F7A3E53D&quot;</span><span class="tok-err">)</span>
<span class="tok-w">            </span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-p">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These equivalence histories would be used by Custodian Organisations to populate artefact identifier equivalence tables that could be shared on request with other manager organisations. This system is reminiscent of the CNAME record type in the internet Domain Name System (DNS), which is used to record alias domain names for canonical domain names.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referencing"><a class="anchor" href="#_referencing"></a>7. Referencing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how artefact are referenced, by other artefacts and software. The general principal for referencing is that references based on human-readable identifiers are used between source artefacts, in the same way as for software, while references in operational forms of the artefacts or from data may be in the form of either HRIDs or machine identifiers.</p>
</div>
<div class="paragraph">
<p>A key semantic difference exists with references as opposed to identifiers. A reference is either a full physical artefact identifier, or else an identifier with partial version information. In both cases, a reference is used to match artefacts carrying full identification. In general, there can be several candidate matches, and therefore a matching algorithm has to be specified in each case, in order to ensure constant meaning for a given reference in all modelling and computing environments.</p>
</div>
<div class="paragraph">
<p>Various forms of the references based on the HRID are used, depending on the need, as described below. These are denoted as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the interface HRID reference (<code>ihrid_ref</code>), which is the same for all artefact instances sharing the same core interface, in other words, the form of the identifier including only the major version; this will match the latest relase available of that major version;</p>
</li>
<li>
<p>the specific interface HRID reference (<code>sihrid_ref</code>), which is the form of the identifier including the major and minor versions, which will match a specific release of the interface;</p>
</li>
<li>
<p>the physical HRID reference (<code>phrid_ref</code>), which identifies artefact instances which are identical; this is the form of identifier with the full version identifier included.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The grammar for this is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">hrid_ref                </span><span class="tok-o">=</span>   <span class="tok-k">namespaced_hrid_ref </span><span class="tok-p">|</span> <span class="tok-k">local_hrid_ref </span><span class="tok-p">;</span>
    <span class="tok-k">namespaced_hrid_ref     </span><span class="tok-o">=</span>   <span class="tok-k">namespace </span><span class="tok-s1">&#39;::&#39;</span> <span class="tok-k">local_hrid_ref </span><span class="tok-p">;</span>
    <span class="tok-k">local_hrid_ref          </span><span class="tok-o">=</span>   <span class="tok-k">ihrid_ref </span><span class="tok-p">|</span> <span class="tok-k">sihrid_ref </span><span class="tok-p">|</span> <span class="tok-k">phrid_ref </span><span class="tok-p">;</span>
    <span class="tok-k">ihrid_ref               </span><span class="tok-o">=</span>   <span class="tok-k">hrid_root </span><span class="tok-s1">&#39;.v&#39;</span> <span class="tok-k">major_version </span><span class="tok-p">;</span>
    <span class="tok-k">sihrid_ref              </span><span class="tok-o">=</span>   <span class="tok-k">hrid_root </span><span class="tok-s1">&#39;.v&#39;</span> <span class="tok-k">major_version </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">minor_version </span><span class="tok-p">;</span>
    <span class="tok-k">phrid_ref               </span><span class="tok-o">=</span>   <span class="tok-k">local_hrid </span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By way of example, the following two archetype iHRID references denote different logical archetypes, from a data processing point of view, since their major versions are different, indicating a breaking change between the two:</p>
</div>
<div class="paragraph">
<p><code>org.openehr::openEHR-EHR-EVALUATION.diagnosis.<strong>v1</strong></code><br>
<code>org.openehr::openEHR-EHR-EVALUATION.diagnosis.<strong>v2</strong></code></p>
</div>
<div class="paragraph">
<p>Conversely, the following references denote physically distinct archetypes that are regarded as logically substitutable:</p>
</div>
<div class="paragraph">
<p><code>org.openehr::openEHR-EHR-EVALUATION.diagnosis.<strong>v1.1.5</strong></code><br>
<code>org.openehr::openEHR-EHR-EVALUATION.diagnosis.<strong>v1.1.7</strong></code></p>
</div>
<div class="sect2">
<h3 id="_source_artefact_references"><a class="anchor" href="#_source_artefact_references"></a>7.1. Source Artefact References</h3>
<div class="paragraph">
<p>This section describes the scenarios and representation required for identifier-based referencing between design time 'source' (i.e. compiler input) artefacts.</p>
</div>
<div class="sect3">
<h4 id="_archetype_external_references_adlaom_2"><a class="anchor" href="#_archetype_external_references_adlaom_2"></a>7.1.1. Archetype External References (ADL/AOM 2)</h4>
<div class="paragraph">
<p>In ADL 2, a direct archetype-archetype reference, known as an 'external reference' can be defined, which uses the archetype miniHRID, as shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">at-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-nc">ACTIVITY</span><span class="tok-p">[</span><span class="tok-nd">at0001</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">   </span><span class="tok-c">-- Medication activity</span>
<span class="tok-w">        </span><span class="tok-nc">description</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-kt">use_archetype </span><span class="tok-nc">ITEM_TREE</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nd">openEHR-EHR-ITEM_TREE.medication.v1</span><span class="tok-p">]</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">id-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-nc">ACTIVITY</span><span class="tok-p">[</span><span class="tok-nd">id2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">   </span><span class="tok-c">-- Medication activity</span>
<span class="tok-w">        </span><span class="tok-nc">description</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-kt">use_archetype </span><span class="tok-nc">ITEM_TREE</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nd">openEHR-EHR-ITEM_TREE.medication.v1</span><span class="tok-p">]</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If such a reference does not include a namespace, the meaning is that the same namespace as the current archetype is assumed (which may be no namespace). A namespace would be included to express a reference to an archetype outside the current namespace.</p>
</div>
<div class="paragraph">
<p>A reference such as the above will resolve to an actual archetype at runtime according to the following algorithm:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the most recent released version variant of <code>openEHR-EHR-ITEM_TREE.medication.v1</code>, i.e. the latest minor or patch version such as <code>v1.0.4</code>, <code>v1.2.49</code> etc OR</p>
</li>
<li>
<p>the latest release candidate version of <code>openEHR-EHR-ITEM_TREE.medication.v1</code>, e.g. <code>v1.2.3-rc44</code>, because 'rc' versions are guaranteed to be semantically compatible with their target version</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because minor versions can include structural additions, it may be that in some cases, archetype external references need to be include a minor version as well - allowing an exact structual form of the archetype (interface) to be identified. Similarly For testing or other research purposes, it should probably be assumed that patch and <code>-rc</code> and <code>-alpha</code> versions of an archetype need to be referenced.</p>
</div>
<div class="paragraph">
<p>The general case is therefore assumed to be that an artefact reference is a <code>hrid_ref</code> , but most commonly an <code>ihrid_ref</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_template_references_to_archetypes_and_templates"><a class="anchor" href="#_template_references_to_archetypes_and_templates"></a>7.1.2. Template References to Archetypes and Templates</h4>
<div class="paragraph">
<p>Templates are normally designed as pre-cursors to software artefacts, such as forms, message definitions and document schemas. Consequently, their exact contents and structure are usually carefully controlled by their developers, in the interests of stability. To achieve this, references from templates to other templates or archetypes need to be able to refer to any level of version of the target artefact. During a development phase, it may be that the template references are limited to major versions of the human-readable identifier, i.e. the <code>ihrid_ref</code> . At some point it may be the case that the minor version must be included as well. As noted above, this is because minor versions of archetypes can include structural additions, and therefore affect the structure of the final document / data-set etc. It may even be the case that patch level versions need to be identified, so as to ensure no changes whatever can occur in the template, even if upgraded versions of the source artefacts become available.</p>
</div>
<div class="paragraph">
<p>Such tight control is not however a universal requirement. A conscious design decision may have been taken that says that the resulting software artefact contents are whatever results from the template definition at the time of publishing, assuming references to major versions only.</p>
</div>
<div class="paragraph">
<p>To accommodate these scenarios, template references to archetypes and other templates need to be legal at any version level. For example, any of the following references should be legal in a template:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.openehr::openEHR-EHR-EVALUATION.problem.v2</code></p>
</li>
<li>
<p><code>org.openehr::openEHR-EHR-EVALUATION.problem.v2.4</code></p>
</li>
<li>
<p><code>org.openehr::openEHR-EHR-EVALUATION.problem.v2.4.17</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In development and research environments, it is reasonable to allow <code>-rc</code> and <code>-alpha</code> variants as well.</p>
</div>
<div class="paragraph">
<p>The general case is therefore as for archetype external references: a template reference is a <code>hrid_ref</code> .</p>
</div>
</div>
<div class="sect3">
<h4 id="_between_specialised_archetypes"><a class="anchor" href="#_between_specialised_archetypes"></a>7.1.3. Between Specialised Archetypes</h4>
<div class="paragraph">
<p>A specialised archetype refers to its parent using the human-readable reference, including only the major version. Two possible variants can occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With a non-namespaced reference. This is assumed to come from the same namespace as the specialised archetype.</p>
</li>
<li>
<p>With a namespaced identifier where the namespace is different from that of the referencing archetype. This resolves against the latest release of the referenced archetype in the locally available repository copy of the referenced namespace.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following figure shows a number of archetypes related by specialisation.</p>
</div>
<div id="specialisation_relationships" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/specialisation_relationships.png" alt="specialisation relationships" width="80%">
</div>
<div class="title">Figure 7. Specialisation Relationships</div>
</div>
<div class="paragraph">
<p>One question that naturally arises to do with specialisation is what happens when the parent archetype is revised. The approach is the same as for object-oriented software: all archetypes in a given 'check-out' or release must always compile at any point in time to be valid. If a revised parent is introduced that invalidates any of its inheritance children, revisions must be made to the children before the repository becomes valid as a whole again. This means that a new version of an archetype in general may require child archetypes to be re-versioned as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_source_artefact_relationship_constraints"><a class="anchor" href="#_source_artefact_relationship_constraints"></a>7.2. Source Artefact Relationship Constraints</h3>
<div class="paragraph">
<p>Related to the concept of 'references' is constraints that when evaluated at runtime, resolve to artefact identifiers. Two types are described here, which are the two kinds of archetype 'slot' definition.</p>
</div>
<div class="sect3">
<h4 id="_adl_1_4_archetype_slots"><a class="anchor" href="#_adl_1_4_archetype_slots"></a>7.2.1. ADL 1.4 Archetype Slots</h4>
<div class="paragraph">
<p>In ADL 1.4, archetypes slots are defined via assertions in their slot statements. Although the specification allows for all kinds of possibilities, the only one in use is regular expressions (REs) on the archetype identifiers allowed to fill the slot. Current ADL 1.4 tooling supports REs on full (non-name-spaced) ADL 1.4 archetype identifiers, which include only the major version number, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    openEHR-EHR-EVALUATION.problem.v1</pre>
</div>
</div>
<div class="paragraph">
<p>Note that such REs often include disjoint patterns, by using the form <code>"id_pattern1|id_pattern2|id_pattern3"</code>.</p>
</div>
<div class="paragraph">
<p>A typical slot definition using REs based on such identifiers is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-nc">protocol</span><span class="tok-w"> </span><span class="tok-o">matches </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nc">ITEM_TREE</span><span class="tok-p">[</span><span class="tok-nd">at0015</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-nc">items</span><span class="tok-w"> </span><span class="tok-kt">cardinality </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-m">0..*; ordered</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-kt">allow_archetype </span><span class="tok-nc">CLUSTER</span><span class="tok-p">[</span><span class="tok-nd">id20</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-kt">occurrences </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-m">0..1</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">matches </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-kt">include</span>
<span class="tok-w">                        </span><span class="tok-nc">archetype_id</span><span class="tok-p">/</span><span class="tok-nc">value</span><span class="tok-p"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-sr">/openEHR-EHR-CLUSTER\.device(-[a-zA-Z0-9_]+)*\.v1/</span><span class="tok-p">}</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This slot allows any archetype named <code>openEHR-EHR-CLUSTER.device.v1</code> or <code>openEHR-EHR-CLUSTER.device-xxx.v1</code>, which used the ADL 1.4 method of signifying specialised archetypes.</p>
</div>
<div class="paragraph">
<p>The rule for namespace inclusion is as for external references:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>no namespace means the same namespace as the current archetype;</p>
</li>
<li>
<p>an explicit namespace means archetypes from that namespace.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As for external references, there is technically nothing to stop a slot RE being defined to refer to specific minor versions or builds of an archetype. The same rule applies: released archetypes should only include major versions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adl_2_archetype_slots"><a class="anchor" href="#_adl_2_archetype_slots"></a>7.2.2. ADL 2 Archetype Slots</h4>
<div class="paragraph">
<p>In ADL 2 a slot can be defined using a semantic (rather than lexical) expression in which matching archetypes are defined in the form of a constraint on the archetype concept (and optionally namespace), reminiscent of the SNOMED CT post-coordination constraint syntax. This is shown in the following example.</p>
</div>
<div class="listingblock">
<div class="title">at-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-kt">allow_archetype </span><span class="tok-nc">CLUSTER</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nd">at0003.1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-kt">occurrences </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-m">0..1</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kt">include </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-l">True</span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-nc">archetype_id</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-nc">ARCHETYPE_ID</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-nc">namespace</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{...}</span>
<span class="tok-w">                    </span><span class="tok-nc">concept</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-nc">investigation_methodology</span><span class="tok-w"> </span><span class="tok-nc">OR</span><span class="tok-w"> </span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-nc">investigation_protocol</span><span class="tok-p">}</span>
<span class="tok-w">                    </span><span class="tok-p">...</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">id-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-kt">allow_archetype </span><span class="tok-nc">CLUSTER</span><span class="tok-w"> </span><span class="tok-p">[</span><span class="tok-nd">id4.1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-kt">occurrences </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-m">0..1</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kt">include </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-l">True</span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-nc">archetype_id</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-nc">ARCHETYPE_ID</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                    </span><span class="tok-nc">namespace</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{...}</span>
<span class="tok-w">                    </span><span class="tok-nc">concept</span><span class="tok-w"> </span><span class="tok-o">∈</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-nc">investigation_methodology</span><span class="tok-w"> </span><span class="tok-nc">OR</span><span class="tok-w"> </span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-nc">investigation_protocol</span><span class="tok-p">}</span>
<span class="tok-w">                    </span><span class="tok-p">...</span>
<span class="tok-w">                </span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above kind of referencing relies on an ontological underpinning for the <code>concept_id</code> part of the human-readable identifier.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aql_query_sets"><a class="anchor" href="#_aql_query_sets"></a>7.3. AQL Query Sets</h3>
<div class="paragraph">
<p>AQL queries are in general authored in a 'set' in order to achieve a design objective, e.g. populate a report, screen, or for some analytical objective. Many are purely local in nature and may be considered 'throwaway'. Others are carefully designed for needs like populating a clinical guideline or performing a standard computation. Within an archetyped framework, such query sets need to be indentified and managed in a similar way to other artefacts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aql_queries"><a class="anchor" href="#_aql_queries"></a>7.4. AQL Queries</h3>
<div class="paragraph">
<p>Archetype-based queries contain archetype references and paths, and can also contain template identifiers and paths. Typical examples are the paths (in green) in the following query:</p>
</div>
<div class="listingblock">
<div class="title">at-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-w">    </span><span class="tok-k">SELECT</span><span class="tok-w"> </span><span class="tok-n">pulse</span>
<span class="tok-w">    </span><span class="tok-k">FROM</span><span class="tok-w"> </span><span class="tok-n">EHR</span><span class="tok-p">[</span><span class="tok-n">ehr_id</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-err">$</span><span class="tok-n">ehruid</span><span class="tok-p">]</span>
<span class="tok-w">     </span><span class="tok-k">CONTAINS</span><span class="tok-w"> </span><span class="tok-n">COMPOSITION</span><span class="tok-w"> </span><span class="tok-k">c</span>
<span class="tok-w">     </span><span class="tok-k">CONTAINS</span><span class="tok-w"> </span><span class="tok-n">OBSERVATION</span><span class="tok-w"> </span><span class="tok-n">pulse</span><span class="tok-p">[</span><span class="tok-n">openEHR</span><span class="tok-o">-</span><span class="tok-n">EHR</span><span class="tok-o">-</span><span class="tok-n">OBSERVATION</span><span class="tok-p">.</span><span class="tok-n">pulse</span><span class="tok-p">.</span><span class="tok-n">v1</span><span class="tok-p">]</span>

<span class="tok-w">    </span><span class="tok-k">WHERE</span><span class="tok-w"> </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">name</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">Encounter</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">context</span><span class="tok-o">/</span><span class="tok-n">start_time</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-err">$</span><span class="tok-n">endperiod</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">context</span><span class="tok-o">/</span><span class="tok-n">start_time</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-err">$</span><span class="tok-n">startPeriod</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-n">pulse</span><span class="tok-o">/</span><span class="tok-k">data</span><span class="tok-o">/</span><span class="tok-n">events</span><span class="tok-p">[</span><span class="tok-n">at0005</span><span class="tok-p">]</span><span class="tok-o">/</span><span class="tok-k">data</span><span class="tok-o">/</span><span class="tok-n">items</span><span class="tok-p">[</span><span class="tok-n">at0003</span><span class="tok-p">]</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">60</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">id-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-w">    </span><span class="tok-k">SELECT</span><span class="tok-w"> </span><span class="tok-n">pulse</span>
<span class="tok-w">    </span><span class="tok-k">FROM</span><span class="tok-w"> </span><span class="tok-n">EHR</span><span class="tok-p">[</span><span class="tok-n">ehr_id</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-err">$</span><span class="tok-n">ehruid</span><span class="tok-p">]</span>
<span class="tok-w">     </span><span class="tok-k">CONTAINS</span><span class="tok-w"> </span><span class="tok-n">COMPOSITION</span><span class="tok-w"> </span><span class="tok-k">c</span>
<span class="tok-w">     </span><span class="tok-k">CONTAINS</span><span class="tok-w"> </span><span class="tok-n">OBSERVATION</span><span class="tok-w"> </span><span class="tok-n">pulse</span><span class="tok-p">[</span><span class="tok-n">openEHR</span><span class="tok-o">-</span><span class="tok-n">EHR</span><span class="tok-o">-</span><span class="tok-n">OBSERVATION</span><span class="tok-p">.</span><span class="tok-n">pulse</span><span class="tok-p">.</span><span class="tok-n">v1</span><span class="tok-p">]</span>

<span class="tok-w">    </span><span class="tok-k">WHERE</span><span class="tok-w"> </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">name</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">Encounter</span><span class="tok-o">`</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">context</span><span class="tok-o">/</span><span class="tok-n">start_time</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&lt;=</span><span class="tok-w"> </span><span class="tok-err">$</span><span class="tok-n">endperiod</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-k">c</span><span class="tok-o">/</span><span class="tok-n">context</span><span class="tok-o">/</span><span class="tok-n">start_time</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&gt;=</span><span class="tok-w"> </span><span class="tok-err">$</span><span class="tok-n">startPeriod</span><span class="tok-w"> </span><span class="tok-k">AND</span>
<span class="tok-w">        </span><span class="tok-n">pulse</span><span class="tok-o">/</span><span class="tok-k">data</span><span class="tok-o">/</span><span class="tok-n">events</span><span class="tok-p">[</span><span class="tok-n">id6</span><span class="tok-p">]</span><span class="tok-o">/</span><span class="tok-k">data</span><span class="tok-o">/</span><span class="tok-n">items</span><span class="tok-p">[</span><span class="tok-n">id4</span><span class="tok-p">]</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-o">/</span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">&lt;</span><span class="tok-w"> </span><span class="tok-mi">60</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The semantics of referencing in queries differ from those of the archetype-to-archetype form, due to the fact that references are normally followed by paths that refer to specific data points within the structure. For an AQL query to be correct, the path must exist in the archetype at the release matched by the reference. Since minor versions can add to the archetype 'interface' (i.e. add data points, and therfore paths, to the structure), a given path needs to reference the oldest archetype for which the path is valid. Consider the following path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-p">[</span><span class="tok-nd">openEHR-EHR-OBSERVATION.pulse.v1</span><span class="tok-p">]/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">events</span><span class="tok-p">[</span><span class="tok-nd">at0006</span><span class="tok-p">]/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">items</span><span class="tok-p">[</span><span class="tok-nd">at0004</span><span class="tok-p">]/</span><span class="tok-nc">value</span><span class="tok-p">/</span><span class="tok-nc">value</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For this to be valid, the path <code>/data/events[at0006]/data/items[at0004]/value/value</code> must exist within the earliest v1.x release of the archetype openEHR-EHR-OBSERVATION.pulse.v1, i.e. v1.0.0. If this path happened to have been added in a more recent minor release, the archetype reference would need to include the first minor version containing that path.</p>
</div>
<div class="paragraph">
<p>Once an AQL query processor can work with a valid path, it will match the following data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any instance of the data point at that path in the referenced archetype;</p>
</li>
<li>
<p>any instance of a data point in a congruent path in a specialisation child archetype.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a congruent path in a child archetype is:</p>
</div>
<div class="listingblock">
<div class="title">at-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-p">/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">events</span><span class="tok-p">[</span><span class="tok-nd">at0005.0.4</span><span class="tok-p">]/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">items</span><span class="tok-p">[</span><span class="tok-nd">at0003.1</span><span class="tok-p">]/</span><span class="tok-nc">value</span><span class="tok-p">/</span><span class="tok-nc">value</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">id-coded ADL2 syntax</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="cadl"><span></span><span class="tok-w">    </span><span class="tok-p">/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">events</span><span class="tok-p">[</span><span class="tok-nd">id6.0.4</span><span class="tok-p">]/</span><span class="tok-nc">data</span><span class="tok-p">/</span><span class="tok-nc">items</span><span class="tok-p">[</span><span class="tok-nd">id4.1</span><span class="tok-p">]/</span><span class="tok-nc">value</span><span class="tok-p">/</span><span class="tok-nc">value</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operational_artefacts"><a class="anchor" href="#_operational_artefacts"></a>7.5. Operational Artefacts</h3>
<div class="paragraph">
<p>Operational artefacts such as flattened archetypes and operational templates generated by compiler tools are built from source artefacts, including by reference resolution from within some source artefacts to others within the current repository of the local and imported artefacts. The particular versions of reference targets are determined by the contents of the configuration, and are thus a function of version management activities, in the same way as for software development.</p>
</div>
<div class="paragraph">
<p>When an operational artefact is generated from controlled source artefacts (i.e. within a Custodian Organisation), it is possible to include the fine-grained revision information from the relevant source artefacts, so that the operational form describes exactly which set of source artefacts were used to produce it. The source artefact semantic signatures can also be included. This information can be included in a configuration section of the artefact. This would be expressed in ODIN (previously dADL) or an XML equivalent, and would list the 'configuration' of concrete artefact revisions used to generate the operational version.</p>
</div>
<div class="paragraph">
<p>The structure of a Configuration is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">configuration       </span><span class="tok-o">=</span>   <span class="tok-k">archetype_config template_config subset_config rm_release </span><span class="tok-p">;</span>
    <span class="tok-k">archetype_config    </span><span class="tok-o">=</span>   <span class="tok-k">config_item </span><span class="tok-p">{</span> <span class="tok-k">config_item </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">template_config     </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">config_item </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">subset_config       </span><span class="tok-o">=</span>   <span class="tok-p">{</span> <span class="tok-k">config_item </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">rm_release          </span><span class="tok-o">=</span>   <span class="tok-k">rm_name release_id </span><span class="tok-p">;</span>

    <span class="tok-k">config_item         </span><span class="tok-o">=</span>   <span class="tok-k">identifier </span><span class="tok-p">[</span> <span class="tok-k">revision_id </span><span class="tok-p">[</span> <span class="tok-k">commit_id </span><span class="tok-p">]</span> <span class="tok-p">]</span> <span class="tok-p">[</span> <span class="tok-k">signature </span><span class="tok-p">]</span> <span class="tok-p">;</span>

    <span class="tok-k">signature           </span><span class="tok-o">=</span>   <span class="tok-k">CHARACTER_SEQUENCE </span><span class="tok-p">;</span>
    <span class="tok-k">revision_id         </span><span class="tok-o">=</span>   <span class="tok-k">V_INTEGER </span><span class="tok-p">;</span>
    <span class="tok-k">commit_id           </span><span class="tok-o">=</span>   <span class="tok-k">V_INTEGER </span><span class="tok-p">;</span>
    <span class="tok-k">release_id          </span><span class="tok-o">=</span>   <span class="tok-k">V_STRING </span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of the configuration of an operational template in a controlled environment (ODIN format) is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="odin"><span></span><span class="tok-w">    </span><span class="tok-nc">archetypes</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">id</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;org.openehr::openEHR-EHR-OBSERVATION.heartrate.v1.3.28&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-nc">signature</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;23895yw85y0y0&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">id</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.gov.nehta::openEHR-EHR-EVALUATION.genetic-diagnosis.v1.2.0&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-nc">signature</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;98typrhweruhfd&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">id</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;org.openehr::openEHR-EHR-EVALUATION.problem.v2.4.0&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">            </span><span class="tok-nc">signature</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;2rfhweiudfwieurfh&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-nc">templates</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">id</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;au.gov.nehta::openEHR-EHR-COMPOSITION.vital_signs.v5.36.1&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-nc">subsets</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">        </span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">            </span><span class="tok-nc">id</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;org.ihtsdo.general::cardiac_diagnoses.v18.1.0&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-nc">rm</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span>
<span class="tok-w">        </span><span class="tok-nc">name</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;org.openehr.rm&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">        </span><span class="tok-nc">release</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">&lt;</span><span class="tok-s">&quot;1.1&quot;</span><span class="tok-p">&gt;</span>
<span class="tok-w">    </span><span class="tok-p">&gt;</span>
<span class="tok-p">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_references_from_data"><a class="anchor" href="#_references_from_data"></a>7.6. References from Data</h3>
<div class="sect3">
<h4 id="_requirements"><a class="anchor" href="#_requirements"></a>7.6.1. Requirements</h4>
<div class="paragraph">
<p>In knowledge-enabled information environments such as those built on the archetype principles, knowledge artefacts are used to control the creation and validation of data, with the effect that data eventually stored in such systems 'conform' to the relevant artefacts. In order to be able to further process (e.g. display, modify and query) such data, references of some kind to the knowledge artefacts must be stored in the data. The requirements for such references depend on where the data are found, broadly within two possible situations, namely data within operational systems (e.g. EHR systems) and data within 'messages', 'extracts', or 'documents' sent between systems.</p>
</div>
<div class="paragraph">
<p>Three requirements can be identified with respect to data within systems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reconstitutability</em>: firstly, it must be possible to re-connect data with the archetypes, templates and subsets, used to create them. This implies that the major and minor versions at least are recorded in data, since a minor version may have an effect on structure.</p>
</li>
<li>
<p><em>Querying</em>: secondly, it must be possible to know what archetypes (including major version), and therefore what path-sets can be used for querying data - given that this may well include parents of specialised archteypes, not just the archetypes used to directly create the data.</p>
</li>
<li>
<p><em>Optimisation</em>: we can also assume that in a typical production system handling millions of health records, that the size of artefect identifiers embedded in data (especially if repeated) may be an issue, and that some kind of space optimisation may be required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Within extracts or messages, the same requirements broadly hold, but could be better restated as follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Reconstitutability</em>: it must be possible for the receiving system to be able to determine the relationship of each data element with the artefacts(s) used to create it, so that it can be correctly reconstituted in the receiver system environment.</p>
</li>
<li>
<p><em>Querying</em>: for ensuring the correct functioning of querying, the extract or message should potentially carry sufficient archetype lineage information the archetypes used in the data to allow querying at the receiver, particularly if the latter wants to be able to query using more general parents (e.g. a 'problem' archetype rather than some specific diagnosis specialisation).</p>
</li>
<li>
<p><em>Optimisation</em>: a reasonable trade-off between space optimisation and clarity of representation must be used, given that messages, extracts etc flow between heterogeneous systems.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_reconstitutability"><a class="anchor" href="#_reconstitutability"></a>7.6.2. Reconstitutability</h4>
<div class="paragraph">
<p>The reconstitutability requirement means recording archetype and template identifiers on the relevant nodes in the data. A basic form of this has always been used in openEHR, such that at archetype root nodes, the archetype identifier and if relevant the template identifier is recorded, and at interior nodes, the at-codes are recorded (formally, the archetype identifier and at-codes are recorded in the <code>LOCATABLE</code> .archetype_node_id attribute of each data node). For example, in data created based on openEHR Releases 1.0.2 or earlier, the archetype identifier references are of the form:</p>
</div>
<div class="paragraph">
<p><code>openEHR-EHR-EVALUATION.diagnosis.v1</code></p>
</div>
<div class="paragraph">
<p>With the more sophisticated identification system described here, these archetype references need to include namespace, and full version identifier, i.e.:</p>
</div>
<div class="paragraph">
<p><code>org.openehr::openEHR-EHR-EVALUATION.diagnosis.<strong>v1.29.0</strong></code></p>
</div>
<div class="paragraph">
<p>References with no namespace will remain legal, since there should be no computational impediment to using uncontrolled archetypes and templates, e.g. in an experimental situation. The lack of minor and patch level version numbers should also be legal for non-namespaced identifiers, and be interpreted as meaning <code>0</code> in both cases, i.e. <code>.v1</code> means <code>.v1.0.0</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_supporting_archetype_based_querying"><a class="anchor" href="#_supporting_archetype_based_querying"></a>7.6.3. Supporting Archetype-based Querying</h4>
<div class="paragraph">
<p>Querying of data in openEHR systems is assumed to be based on archetype 'path-sets', i.e. the set of paths extracted from an operational (flat-form) archetype. The paths are a slight simplification of standard X-paths. Two querying methods have been described to date, AQL and a-path, both making this assumption (see <a href="#openehr_query_aql">[openehr_query_aql]</a> ).</p>
</div>
<div class="paragraph">
<p>Based on this assumption, given an archetype X used to create data, the following archetypes could be used for querying:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>X, i.e. exact same version, revision &amp; commit;</p>
</li>
<li>
<p>any previous minor or patch variant of X;</p>
</li>
<li>
<p>any of the specialisation parents of X;</p>
</li>
<li>
<p>any previous minor or patch variant of any of the specialisation parents of X.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For non-specialised archetypes, the allowable querying archetypes can be deduced from the archetype reference recorded in the data. For specialised archetypes, the specialisation lineage can only be obtained from the operational form of the archetype, found in the template used to create the data. This would create a potential problem where for data imported from another site without the relevant template(s), the archetype lineage information was not available. This would prevent the query engine at the receiver system knowing how to query the data using even the more general archetypes in the lineage, that it may have access to.</p>
</div>
<div class="paragraph">
<p>To address this situation, one of the following strategies is required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>include the configuration meta-data from the operational template(s) with the data when it is exchanged, i.e. in an EHR Extract.</p>
</li>
<li>
<p>include archetype lineage information in the data itself. This could be a modified form of the identifier reference in the case of specialised archetypes to allow lineage information to be stored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The second approach can be considered a generalisation of recording just the current archetype identifier, i.e. the 'lineage' for non-specialised archetypes evaluates to just that archetype id, and for specialised archteypes, it will be a list. This specification assumes that the second is used.</p>
</div>
<div class="paragraph">
<p>The simplest form of this would be as a list of operational identifiers, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    au.gov.nehta::openEHR-EHR-EVALUATION.genetic_diagnosis.v1.12.9,
    org.openehr::openEHR-EHR-EVALUATION.diagnosis.v1.29.0,
    org.openehr::openEHR-EHR-EVALUATION.problem.v2.4.18</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_formal_model_2"><a class="anchor" href="#_formal_model_2"></a>7.6.4. Formal Model</h4>
<div class="paragraph">
<p>A formal definition of reference catering to the above requirements is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="ebnf"><span></span>    <span class="tok-k">archetype_data_ref  </span><span class="tok-o">=</span>   <span class="tok-k">archetype_ver_ref </span><span class="tok-p">{</span> <span class="tok-s1">&#39;,&#39;</span> <span class="tok-k">archteype_ver_ref </span><span class="tok-p">}</span> <span class="tok-p">;</span>
    <span class="tok-k">archteype_ver_ref   </span><span class="tok-o">=</span>   <span class="tok-k">hrid_root </span><span class="tok-s1">&#39;.&#39;</span> <span class="tok-k">version_id_ref </span><span class="tok-p">;</span>
    <span class="tok-k">version_id_ref      </span><span class="tok-o">=</span>   <span class="tok-s1">&#39;v&#39;</span> <span class="tok-k">version_id </span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_optimisations"><a class="anchor" href="#_optimisations"></a>7.6.5. Optimisations</h4>
<div class="paragraph">
<p>In normal archetype-based data, both basic references and additional lineage information might be repeated throughout a given component, such as an openEHR or <a href="https://www.iso.org/standard/40784.html">ISO 13606</a> <code>COMPOSITION</code> . Consider a <code>COMPOSITION</code> documenting problems &amp; diagnoses of the patient, where each problem is recorded using the archetype</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    uk.nhs.royalfree.clinical::openEHR-EHR-EVALUATION.diagnosis.v2.15.0</pre>
</div>
</div>
<div class="paragraph">
<p>whose lineage is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    org.openehr::openEHR-EHR-EVALUATION.diagnosis.v1.29.0
    org.openehr::openEHR-EHR-EVALUATION.problem.v2.4.0</pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the archetype reference lengths are 66, 57 and 54 characters respectively, i.e. a total of 177 characters. Repeated say 5 times would give 885 characters of identifier meta-data for the <code>COMPOSITION</code> , whose main clinical data could easily be similar. Even in an XML-based storage system, various kinds of compression are used, the identifier reference overhead might be considered as an unacceptable fraction of the overall data storage requirement.</p>
</div>
<div class="paragraph">
<p>It is therefore worth considering various simple optimisations, while retaining clarity and comprehensibility in the data. The following ideas are currently intended to be limited to serialised forms of data. They would therefore only require changes to openEHR XML-schemas rather than the abstract reference model.</p>
</div>
<div class="sect4">
<h5 id="_identifier_aliasing"><a class="anchor" href="#_identifier_aliasing"></a>7.6.5.1. Identifier Aliasing</h5>
<div class="paragraph">
<p>The most obvious optimisation is to use a set of variable references local to the data context, in this case an openEHR or ISO 13606 Extract. For example, at the top of the Extract, the following definitions could be made:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    id01=uk.nhs.royalfree::openEHR-EHR-EVALUATION.diagnosis.v2.15.0,
        org.openehr::openEHR-EHR-EVALUATION.diagnosis.v1.29.0,
        org.openehr::openEHR-EHR-EVALUATION.problem.v2.4.0
    id02=au.gov.nehta::openEHR-EHR-OBSERVATION.hba1c_result.v1.4,
        org.openehr::openEHR-EHR-OBSERVATION.lab_result.v1.18
    etc</pre>
</div>
</div>
<div class="paragraph">
<p>The identifiers <code>id01</code>, <code>id02</code> etc would then be used in the data, reducing the identifier overhead by perhaps 50% in some cases. This possibility would be enabled by adding an attribute to contain the variable definitions at the top of the <code>EHR_EXTRACT</code> type in the openEHR Reference Model, and in equivalent classes in other models.</p>
</div>
<div class="paragraph">
<p>The use of such variables will slightly complicate querying and other data processing, since a query that returns part of a Composition would return data containing meaningless local variable names rather than proper archetype meta-data.</p>
</div>
<div class="paragraph">
<p>A second question to consider is whether any parts of the identifiers could be removed. For example, it might initially appear that the reference model and class identification could be removed altogether, since the data when initially created would seem by definition to be based on the reference model and class of the archetype. However, neither are guaranteed. Consider the following two cases which use archetypes based on a different reference model to create data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a data extractor that transforms source data, say in openEHR form, to a standard form, say in ISO 13606 form. The archetype identifiers embedded in the latter data will be the original openEHR archetype identifiers (the extractor does not create new archetypes to do its transformation work);</p>
</li>
<li>
<p>a product that is directly based on another standard, such as ISO 13606 but uses the published library of openEHR archetypes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Similarly, in the case of the class, the data may easily be based on a descendant (e.g. the <code>POINT_EVENT</code> class in openEHR) of the class mentioned in the archetype (e.g. <code>EVENT</code> ).</p>
</div>
<div class="paragraph">
<p>We therefore assume that although some of the above assumptions might be available in very particular environments, they cannot be safely made in general, particularly since it can never be predicted where data may be shared.</p>
</div>
</div>
<div class="sect4">
<h5 id="_reference_compression"><a class="anchor" href="#_reference_compression"></a>7.6.5.2. Reference Compression</h5>
<div class="paragraph">
<p>Nevertheless, it would be possible to go further in terms of removing repetition in the once-only declarations. For instance, a compressed form of the archetype lineage information could be constructed, whereby repeated sections in each subsequent identifier are replaced by a special character. The example above would become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    id01=uk.nhs.royalfree::openEHR-EHR-EVALUATION.diagnosis.v2.15.0,
        org.openehr::~.diagnosis.v1.29.0,
        ~::~.problem.v2.4.0
    id02=au.gov.nehta::openEHR-EHR-OBSERVATION.hba1c_result.v1.4.0,
        org.openehr.ehr::~.lab_result.v1.18.0</pre>
</div>
</div>
<div class="paragraph">
<p>The above syntax uses the <code>~</code> character in each identifier in the list to mean 'the missing parts are taken from the corresponding element(s) of the previous identifier in the list' (the inspiration is the use of the <code>~</code> in dictionaries to stand for the keyword). In this syntax, the concrete archetype used to create the data is guaranteed to appear first and in its entirety in the list.</p>
</div>
<div class="paragraph">
<p>Clearly in a particular system in which archetypes were only ever used from the same reference model as the system itself is built on, an even further reduced form of these references could be created. However, if the data were ever to be shared, such references would be in danger of being non-interoperable.</p>
</div>
<div class="paragraph">
<p>Whether the additional saving in space justifies the added complexity in parsing is debatable.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_reliable_uri_for_knowledge_resources"><a class="anchor" href="#_a_reliable_uri_for_knowledge_resources"></a>8. A Reliable URI for Knowledge Resources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There should be a standardised and reliable Uniform Resource Identifier (URI) for all released knowledge resources, in both source and operational forms. This may justify its own scheme-space, but is at least achievable within the normal http scheme-space.</p>
</div>
<div class="paragraph tbd">
<p><strong>To Be Continued</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_artefact_authentication"><a class="anchor" href="#_artefact_authentication"></a>9. Artefact Authentication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In theory, revision information should be reliable, and no two physical knowledge artefacts should exist that are either identical but have different identifiers and/or revision information, or are different but are identified as being the same. However, in practical systems, such situations can occur due to uncontrolled artefact creation, uncontrolled copying, and errors in version management.</p>
</div>
<div class="paragraph tbd">
<p><em>TBD</em>: hashing on source v operational artefacts? Consider templates that don&#8217;t change but referenced archetypes that do.</p>
</div>
<div class="sect2">
<h3 id="_integrity_check"><a class="anchor" href="#_integrity_check"></a>9.1. Integrity Check</h3>
<div class="paragraph">
<p>It is therefore useful to be able to determine whether two artefacts (usually purported copies or subsequent revisions) are the same or not, even if the version information is the same. This can be achieved by the use of a digital hash function (e.g. SHA-1, MD5), which generates a 'fingerprint' of the artefact. Two archetypes with the same hash value must be the same – hash functions generate a different result if even a single bit is different in the input stream. However, applying such functions to the typical file representation of an archetype or template will not usually have the desired result. This is because differences in white-space and non-significant ordering, which make no difference to the semantics – will still generate different hash values. Other semantically insignificant differences include changes to meta-data values, such as descriptions, etc may have been changed (e.g. to correct spelling, improving wording), and changes or additions to translations.</p>
</div>
<div class="paragraph">
<p>As a consequence, the input to a hashing function for the purpose of generating a semantic signature of an openEHR knowledge artefact must be some canonical form of the original literal artefact, that is impervious to differences of the above types while retaining differences that will affect computation with such artefacts. The integrity check process is illustrated below.</p>
</div>
<div id="integrity_check" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/integrity_check.png" alt="integrity check" width="60%">
</div>
<div class="title">Figure 8. Integrity Check Scheme</div>
</div>
</div>
<div class="sect2">
<h3 id="_authentication"><a class="anchor" href="#_authentication"></a>9.2. Authentication</h3>
<div class="paragraph">
<p>A second need to do with validity of knowledge artefacts is establishing their authenticity, i.e. their true origin. The usual way of supporting authentication is with a digital signature. A typical scheme based on the public key infrastructure (PKI) concept is for the producer of an artefact to sign it with their private key, and for the public key to be used by a consumer of the artefact to decrypt the signed entity.</p>
</div>
<div class="paragraph">
<p>In the case of openEHR knowledge artefacts, the need is to know the originating Custodian Organisation of an artefact. The PKI approach is for each CO to generate a key pair, and to provide the public key to the Central Governance Authority. Signing is then carried out using the CO private key on the hash digest already generated for an artefact. The modified process is illustrated in below.</p>
</div>
<div id="signing" class="imageblock text-center text-center">
<div class="content">
<img src="Identification/diagrams/signing.png" alt="signing" width="80%">
</div>
<div class="title">Figure 9. Digital Signing</div>
</div>
</div>
<div class="sect2">
<h3 id="_canonical_form_archetype_semantic_view"><a class="anchor" href="#_canonical_form_archetype_semantic_view"></a>9.3. Canonical Form – Archetype 'semantic view'</h3>
<div class="paragraph">
<p>For hashing and signing to be useful, the input artefacts need to have two characteristics. Firstly, we need to know that the artefact has been validated, since there is no use in disseminating digitally authenticated but useless artefacts. Secondly, the effects of 'non-semantic' changes in the artefact must be removed. This requires a syntactic canonical form.</p>
</div>
<div class="paragraph">
<p>Both requirements can be achieved for archetypes and templates with a canonical form based on a 'semantic view' of an archetype, analagous to the 'interface class' idea in software development. The semantic view is created from a specific serialisation of the abstract syntax tree (AST) form of the artefact, which is its computable form. The full AST form is in fact defined by the openEHR AOM, but this contains all textual meta-data from the description, ontology and other sections of the archetype. The 'semantic' form of this model, suitable for generating a normalised serialisation for hashing has the following reduced form:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the identifier;</p>
</li>
<li>
<p>specialisation identifier, where present;</p>
</li>
<li>
<p>concept code;</p>
</li>
<li>
<p>definition section (comments stripped).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These objects would be represented in the same form as defined by the AOM. A suitable serialisation is the dADL syntax form. XML forms could be used, but they depend on which schema variant is in use, and there is no single normative openEHR XML-schema for the AOM.</p>
</div>
<div class="paragraph tbd">
<p><em>TBD</em>: canonical forms of other artefact types. Since all forms of archetypes and templates are now AOM-based (as of 1.5), a single canonical algorithm based on the AOM (with TOM extensions) can be described.</p>
</div>
<div class="paragraph tbd">
<p><em>TBD</em>: Operational template hashing &amp; signing is required</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scenarios"><a class="anchor" href="#_scenarios"></a>10. Scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes typical scenarios to do with artefact development, deployment and querying.</p>
</div>
<div class="sect2">
<h3 id="_minor_version_upgrade"><a class="anchor" href="#_minor_version_upgrade"></a>10.1. Minor Version Upgrade</h3>

</div>
<div class="sect2">
<h3 id="_major_version_upgrade"><a class="anchor" href="#_major_version_upgrade"></a>10.2. Major Version Upgrade</h3>

</div>
<div class="sect2">
<h3 id="_templates_using_archteypes_and_subsets"><a class="anchor" href="#_templates_using_archteypes_and_subsets"></a>10.3. Templates using Archteypes and Subsets</h3>

</div>
<div class="sect2">
<h3 id="_artefact_transfer_fork"><a class="anchor" href="#_artefact_transfer_fork"></a>10.4. Artefact Transfer / Fork</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="Beale_Heard2007"></a>Beale, T., &amp; Heard, S. (2007). An Ontology-based Model of Clinical Information. In K. K. et al. (Ed.), <em>Proceedings MedInfo 2007</em> (pp. 760–764). IOS Publishing. Retrieved from <a href="http://www.openehr.org/publications/health_ict/MedInfo2007-BealeHeard.pdf" class="bare">http://www.openehr.org/publications/health_ict/MedInfo2007-BealeHeard.pdf</a></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-02-19 14:36:31 UTC
</div>
</div>
</body>
</html>